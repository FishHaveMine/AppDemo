(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-39586f23"],{"13a1":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("4de4"),core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("4160"),core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_array_includes__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("caad"),core_js_modules_es_array_includes__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_array_includes__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_array_index_of__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("c975"),core_js_modules_es_array_index_of__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_array_index_of__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_array_join__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("a15b"),core_js_modules_es_array_join__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_array_join__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_array_map__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("d81d"),core_js_modules_es_array_map__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_array_map__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_array_splice__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("a434"),core_js_modules_es_array_splice__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_array_splice__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_function_name__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("b0c0"),core_js_modules_es_function_name__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_function_name__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es_map__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("4ec9"),core_js_modules_es_map__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es_map__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es_object_to_string__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("d3b7"),core_js_modules_es_object_to_string__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es_object_to_string__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es_regexp_constructor__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("4d63"),core_js_modules_es_regexp_constructor__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es_regexp_constructor__WEBPACK_IMPORTED_MODULE_10__),core_js_modules_es_regexp_exec__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("ac1f"),core_js_modules_es_regexp_exec__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_es_regexp_exec__WEBPACK_IMPORTED_MODULE_11__),core_js_modules_es_regexp_to_string__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("25f0"),core_js_modules_es_regexp_to_string__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es_regexp_to_string__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_es_string_includes__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("2532"),core_js_modules_es_string_includes__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_es_string_includes__WEBPACK_IMPORTED_MODULE_13__),core_js_modules_es_string_iterator__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("3ca3"),core_js_modules_es_string_iterator__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(core_js_modules_es_string_iterator__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_es_string_replace__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("5319"),core_js_modules_es_string_replace__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_es_string_replace__WEBPACK_IMPORTED_MODULE_15__),core_js_modules_es_string_split__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("1276"),core_js_modules_es_string_split__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(core_js_modules_es_string_split__WEBPACK_IMPORTED_MODULE_16__),core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("159b"),core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_17__),core_js_modules_web_dom_collections_iterator__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("ddb0"),core_js_modules_web_dom_collections_iterator__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(core_js_modules_web_dom_collections_iterator__WEBPACK_IMPORTED_MODULE_18__),E_BaiduNetdiskDownload_uniapp_uniapp_node_modules_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("53ca"),E_BaiduNetdiskDownload_uniapp_uniapp_node_modules_babel_runtime_helpers_esm_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("b85c"),vant__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("d399"),_components_public_wangEnduit__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("8e59");parent.window.setFormBaseInfo=function(){},parent.window.getNextNodeList=function(){},__webpack_exports__["a"]={name:"formByJson",inject:["reload"],data:function(){return{formResult:{},showResult:!1,formItemData:[],formItemList:[],formItemMap:new Map,formItemLocMap:new Map,formErrorMsg:"",loadWitheValue:!1,requiredList:[],showTimePicker:!1,timePickerItem:{},minDate:new Date(2020,0,1),maxDate:new Date(2025,10,1),kidFromItem:{},kidFromValue:[],activeName:"0",variables:[],tabelRequire:[],searchValue:"",pickerLoading:!1,showSelectPicker:!1,showMultiplePicker:!1,showPopup:!1,selectPickerItem:{},PickerItemValue:"",selectColumns:[],selectedColumns:new Map,loadFunList:[],columnsMap:new Map,initFormDate:{},processAuditList:[],ignoreRule:!1}},components:{EditorBar:_components_public_wangEnduit__WEBPACK_IMPORTED_MODULE_22__["a"]},props:{formKey:{required:!0,default:"change",type:String},formReadOnly:{required:!1,default:!1,type:Boolean},fileData:{required:!1,default:function(){return{}},type:Object},BaseInfo:{required:!1,default:function(){return{}},type:Object}},watch:{formKey:function(){""!==this.formKey&&this.initForm()},searchValue:function(){""===this.searchValue&&this.onSearchCancel()}},beforeDestroy:function(){window.location.reload()},beforeMount:function(){var e=new Date;this.minDate=new Date(e.getFullYear(),0,1),this.maxDate=new Date(e.getFullYear()+5,12,30),app.PostData=this.PostData,window.getNowFormatTime=this.getNowFormatTime,window.getNowFormatDate=this.getNowFormatDate,app.setVariables=this.setVariables,app.setFileData=this.setFileData,app.getVariables=this.getVariables,app.setBaseInfo=this.setBaseInfo,app.getBaseInfo=this.getBaseInfo,app.setDisableByKey=this.setDisableByKey,app.setHiddenByKey=this.setHiddenByKey,app.setRequiredByKey=this.setRequiredByKey,app.setOptionsByKey=this.setOptionsByKey,app.getValue=this.getValue,app.setValue=this.setValue,app.initFormWitheValue=this.initFormWitheValue,app.setTabelRequire=this.setTabelRequire},mounted:function(){},methods:{toSubmit:function(e){return this.ignoreRule=e,this.$refs.formByJson.submit()},onVariablesSubmit:function(){var e,t=this,o={},s=Object(E_BaiduNetdiskDownload_uniapp_uniapp_node_modules_babel_runtime_helpers_esm_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_20__["a"])(t.variables);try{for(s.s();!(e=s.n()).done;){var n=e.value;o[n]=this.getValue(n)}}catch(i){s.e(i)}finally{s.f()}return o},setTabelRequire:function(e){this.tabelRequire=e},setVariables:function(e){this.variables=e},setFileData:function(e){this.fileData=e},getVariables:function(){return this.variables},setBaseInfo:function(e){this.BaseInfo=e,this.initTheProcessRelation()},initTheProcessRelation:function(){var e=this;this.$nextTick((function(){e.processAuditList&&e.BaseInfo.basicFlowInstanceLogList&&e.processAuditList.forEach((function(t){var o,s={},n=!1,i=Object(E_BaiduNetdiskDownload_uniapp_uniapp_node_modules_babel_runtime_helpers_esm_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_20__["a"])(e.BaseInfo.basicFlowInstanceLogList);try{for(i.s();!(o=i.n()).done;){var a=o.value;a.nodeName===t.options.processNodeName&&(s=a,n=!0)}}catch(p){i.e(p)}finally{i.f()}if(!n&&e.BaseInfo.basicFlowInstanceLogList.length>1&&"processAuditComments"!=t.type&&(s=e.BaseInfo.basicFlowInstanceLogList[0],n=!0),n){var r="";"processAudit"==t.type&&(r=s.userName),"processAuditTime"==t.type&&(r=s.dealTime),"processAuditComments"==t.type&&(r="处理人:"+s.userName+",意见:"+s.value),"processRelationWorkNum"==t.type?e.getTheProcessRelationWorkNum(t):e.setValue(t.model,r)}else if("processRelationWorkNum"==t.type)e.getTheProcessRelationWorkNum(t);else if("processAuditComments"==t.type&&e.BaseInfo.basicFlowInstanceLogList.length>1){var l,c="",u=Object(E_BaiduNetdiskDownload_uniapp_uniapp_node_modules_babel_runtime_helpers_esm_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_20__["a"])(e.BaseInfo.basicFlowInstanceLogList);try{for(u.s();!(l=u.n()).done;){var d=l.value;c=c+"处理人:"+d.userName+",意见:"+d.value+"\n"}}catch(p){u.e(p)}finally{u.f()}e.setValue(t.model,c)}}))}))},getTheProcessRelationWorkNum:function(e){var t=JSON.parse(JSON.stringify(e)),o=this,s="/",n={processInstId:this.BaseInfo.processInstanceId};this.postAxios(s+"/ops/workflow/query/rest/processInst/queryRelationWork",n).then((function(s){if(0===s.errorCode){var n=s.responseBody||[],i=n;if(e.options.processNodeName&&n.length>0){i=[];var a,r=Object(E_BaiduNetdiskDownload_uniapp_uniapp_node_modules_babel_runtime_helpers_esm_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_20__["a"])(n);try{for(r.s();!(a=r.n()).done;){var l=a.value;l.processName===e.options.processNodeName&&i.push(l)}}catch(u){r.e(u)}finally{r.f()}0==i.length&&(i=n)}var c="";i&&(i.forEach((function(e){var t=e.workNumber+":"+e.activityName+"\n";c+=t})),o.setValue(t.model,c))}}))},getBaseInfo:function(){return this.BaseInfo},getNowFormatTime:function(){var e=new Date,t="-",o=":",s=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),a=e.getHours(),r=e.getMinutes(),l=e.getSeconds();n>=1&&n<=9&&(n="0"+n),i>=0&&i<=9&&(i="0"+i),a>=0&&a<=9&&(a="0"+a),r>=0&&r<=9&&(r="0"+r),l>=0&&l<=9&&(l="0"+l);var c=s+t+n+t+i+" "+a+o+r+o+l;return c},getNowFormatDate:function(){var e=new Date,t="-",o=e.getFullYear(),s=e.getMonth()+1,n=e.getDate();s>=1&&s<=9&&(s="0"+s),n>=0&&n<=9&&(n="0"+n);var i=o+t+s+t+n;return i},PostData:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;this.postAxios(t,o).then((function(e){s(e)}))},setValueAsynchronous:function(e,t){var o=[],s=[];function n(e){e.forEach((function(e){Array.isArray(t)?(t.includes(e.label)||t.includes(e.value))&&(o.push(e.label),s.push({value:e.value,label:e.label}),e.children&&e.children.length>0&&o.length<t.length&&n(e.children)):t!==e.label&&t!==e.value||(o.push(e.label),s.push({value:e.value,label:e.label}),e.children&&e.children.length>0&&o.length<t.length&&n(e.children))}))}n(JSON.parse(JSON.stringify(e.options.options))),o.length>0&&(this.selectedColumns.set(e.model,s),this.selectedColumns.set(e.key,s),e.options.defaultValue=o.join(","))},baseSetValue:function(e,t,o){var s=this,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{var i=!1,a=new Map;return this.formItemData.forEach((function(r){if(r.key==e||r.model==e||r.parent==e){i=!0;var l={targrt:t,value:o,item:JSON.parse(JSON.stringify(r))};if(a.set(r.model,l),r.options[t]=o,"defaultValue"==t){if(!o){var c=JSON.parse(JSON.stringify(r.options.defaultValue));r.options.value=Array.isArray(c)?[]:"",r.options.defaultValue=""}r.options.hasOwnProperty("options")&&r.options.hasOwnProperty("remote")?r.options.remote&&"func"==r.options.remoteType&&!s.loadFunList.includes(r.key)?s.loadTheOptions(r).then((function(){s.setValueAsynchronous(r,o)})):s.setValueAsynchronous(r,o):(r.options.value=o,r.options.defaultValue=o)}else r.options[t]=o;if("options"==t){var u=[];u=o.map((function(e){return e.id=e.value,e.text=e.label,e})),r.options.options=u,s.columnsMap.set(r.key,u)}n&&(r.options.defaultValue=""),s.$set(s.formItemData,s.formItemLocMap.get(r.model),r)}})),i}catch(r){return!1}},setDisableByKey:function(e,t){try{return this.baseSetValue(e,"disabled",t)}catch(o){return console.error(o),!1}},setHiddenByKey:function(e,t){try{return this.baseSetValue(e,"hidden",t)}catch(o){return console.error(o),!1}},setRequiredByKey:function(e,t){try{return this.baseSetValue(e,"required",t)}catch(o){return console.error(o),!1}},setOptionsByKey:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{return!!Array.isArray(t)&&this.baseSetValue(e,"options",t,o)}catch(s){return console.error(s),!1}},toTrigger:function toTrigger(type,item){var funName="";if("click"==type&&(funName=item.options.onClick),"change"==type&&(funName=item.options.onChange),"blur"==type&&(funName=item.options.onBlur),"focus"==type&&(funName=item.options.onFocus?item.options.onFocus:item.options.onClick),""!=funName&&"undefined"!=typeof funName)try{window[funName](this,item)}catch(err){var fun=funName+"()";eval(fun)}},getValue:function(e){try{var t={};this.formItemData.forEach((function(o){o.key!=e&&o.model!=e||(t=o)}));var o=!!t&&(Array.isArray(t.options.defaultValue)?t.options.defaultValue.join(","):t.options.defaultValue);if("select"==t.type||"cascader"==t.type){var s=this.selectedColumns.get(e);if(Array.isArray(s)){var n=[],i=[];s.forEach((function(e){n.push(e.value),i.push(e.label)})),o=n.join(",")}else o=!!s.id&&s.id}return o}catch(a){return!1}},setValue:function(e,t){var o=this;try{this.$nextTick((function(){return o.baseSetValue(e,"defaultValue",t,!1)}))}catch(s){return console.error(s),!1}},addLocalJS:function(e){var t=document.createElement("script");t.type="text/javascript",t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)},loadJS:function(e){return new Promise((function(t,o){var s=document.createElement("script");s.type="text/javascript",s.readyState?s.onreadystatechange=function(){"loaded"!=s.readyState&&"complete"!=s.readyState||(s.onreadystatechange=null,t())}:s.onload=function(){t()};var n=window.config.baseUrl;s.src=n+"/elementForm/"+e+"?"+Math.random(),document.getElementsByTagName("head")[0].appendChild(s)}))},toSetFormItemData:function(e){if(e){var t,o=Object(E_BaiduNetdiskDownload_uniapp_uniapp_node_modules_babel_runtime_helpers_esm_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_20__["a"])(e);try{for(o.s();!(t=o.n()).done;){var s=t.value;this.initValue(s)}}catch(n){o.e(n)}finally{o.f()}}this.initTheProcessRelation(),this.loadWitheValue=!0;try{onMounted()}catch(i){console.error(i)}try{onFormMounted()}catch(i){console.error(i)}},loadTheOptions:function(e){var t=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(s,n){if(e.options.value=e.options.defaultValue,e.options.remote&&"option"==e.options.remoteType){try{var i=t.optionList[e.options.remoteOption];if(i&&i.length>0)e.options.options=i.map((function(e){return e.id=e.value,e.text=e.label,e}));else if(i=t.initFormDate.hasOwnProperty(e.model)?t.initFormDate[e.model].value||""==t.initFormDate[e.model].value?"string"==typeof e.options.defaultValue?t.initFormDate[e.model].value:t.initFormDate[e.model].value.split(","):t.initFormDate[e.model]:e.options.defaultValue?e.options.defaultValue:[],i&&i.length>0){if(i instanceof Array&&t.initFormDate.hasOwnProperty(e.model)){var a=t.initFormDate[e.model].label.split(","),r=[];i.forEach((function(e,t){if(""!==e){var o={id:e,text:a[t]};r.push(o)}})),e.options.options=""==t.initFormDate[e.model].value?[]:r,e.options.defaultValue=t.initFormDate[e.model].label}}else e.options.options=[]}catch(l){e.options.options=[]}t.columnsMap.set(e.key,JSON.parse(JSON.stringify(e.options.options))),s()}if(e.options.remote&&"func"==e.options.remoteType)try{t.loadFunList.includes(e.key)&&o?s():window[e.options.remoteFunc]().then((function(o){var n=[];if(o&&o.list?n=o.list.options.map((function(e){return e.id=e.value,e.text=e.label,e})):console.error(e.options.remoteFunc+"加载失败"),e.options.options=n,t.loadFunList.push(e.key),t.columnsMap.set(e.key,n),"cascader"===e.type){var i=JSON.parse(JSON.stringify(e.options.options)),a=t.getMaxFloor(i);t.fixMax(i,a),e.options.options=i,t.columnsMap.set(e.key,i)}s()}))}catch(c){t.columnsMap.set(e.key,[]),s()}}))},initForm:function(){var e=this;vant__WEBPACK_IMPORTED_MODULE_21__["a"].loading({duration:0,message:"加载中...",forbidClick:!0,loadingType:"spinner"});var t={formKey:this.formKey},o="/";this.postAxios(o+"ops/workflow/formDefinition/rest/queryFormDefinition",t).then((function(t){if(0==t.errorCode){var s=JSON.parse(t.responseBody.formJson);if(t.responseBody.formJs&&null!==t.responseBody.formJs&&(e.addLocalJS(t.responseBody.formJs),"{}"!==JSON.stringify(option)&&(e.optionList=option)),e.formItemList=s.list,s.optionUrl)e.loadJS("init.js").then((function(){staticInfo.uploadHost=o+"ops/",e.loadJS(s.optionUrl).then((function(){s.unitUrl&&e.loadJS(s.unitUrl).then((function(){"{}"!==JSON.stringify(option)&&(e.optionList=option),e.toSetFormItemData(e.formItemList)}))}))}));else if(s.unitUrl)e.loadJS(s.unitUrl).then((function(){"{}"!==JSON.stringify(option)&&(e.optionList=option),e.toSetFormItemData(e.formItemList)}));else{if(s.list&&!s.unitUrl){var n,i=Object(E_BaiduNetdiskDownload_uniapp_uniapp_node_modules_babel_runtime_helpers_esm_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_20__["a"])(s.list);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.initValue(a)}}catch(r){i.e(r)}finally{i.f()}}try{onMounted()}catch(l){console.error(l)}try{onFormMounted()}catch(l){console.error(l)}}}else vant__WEBPACK_IMPORTED_MODULE_21__["a"].fail("加载模板失败");vant__WEBPACK_IMPORTED_MODULE_21__["a"].clear()})).catch((function(){vant__WEBPACK_IMPORTED_MODULE_21__["a"].fail("加载模板失败"),vant__WEBPACK_IMPORTED_MODULE_21__["a"].clear()}))},formItemDataInit:function(e){if("processAudit"==e.type||"processAuditTime"==e.type||"processAuditComments"==e.type||"processRelationWorkNum"==e.type){var t,o=!1,s=Object(E_BaiduNetdiskDownload_uniapp_uniapp_node_modules_babel_runtime_helpers_esm_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_20__["a"])(this.processAuditList);try{for(s.s();!(t=s.n()).done;){var n=t.value;if(n.key===e.key){o=!0;break}}}catch(a){s.e(a)}finally{s.f()}o||this.processAuditList.push(e)}if(this.loadTheOptions(e),("cascader"===e.type||e.options.multiple)&&Array.isArray(e.options.defaultValue)&&(e.options.defaultValue=e.options.defaultValue.join(",")),this.initFormDate.hasOwnProperty(e.model)){var i=this.initFormDate[e.model].value||this.initFormDate[e.model].hasOwnProperty("value")?this.initFormDate[e.model].label:this.initFormDate[e.model];e.options.defaultValue=i,e.options.value=this.initFormDate[e.model].value||this.initFormDate[e.model].hasOwnProperty("value")?this.initFormDate[e.model].value:this.initFormDate[e.model]}this.formItemLocMap.get(e.model)?this.$set(this.formItemData,this.formItemLocMap.get(e.model),e):(this.formItemData.push(e),this.formItemLocMap.set(e.model,this.formItemData.length-1)),void 0==Object(E_BaiduNetdiskDownload_uniapp_uniapp_node_modules_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_19__["a"])(e.options.defaultValue)&&(e.options.defaultValue=""),this.formItemMap.set(e.model,e)},initValue:function(e){var t=this;if(e.options.required&&this.requiredList.push(e.model),"table"===e.type){this.kidFromItem=e;var o=this.initFormDate.hasOwnProperty(e.model+"_tableColumnsSave")?JSON.parse(JSON.stringify(this.initFormDate[e.model+"_tableColumnsSave"])):null;if(o&&(e.tableColumns=o),this.initFormDate.hasOwnProperty(e.model)){var s=this.initFormDate[e.model];s&&s.forEach((function(e){var o=JSON.parse(JSON.stringify(t.kidFromItem.tableColumns));o.map((function(o){t.loadTheOptions(o,!1),o.key=t.kidFromItem.model+"/"+o.model;var s=e[o.model].value||e[o.model].hasOwnProperty("value")?e[o.model].label:e[o.model];return o.options.defaultValue=s,o})),t.kidFromValue.push(o)}))}}if("config"!==e.type&&"table"!==e.type&&"grid"!==e.type)this.formItemDataInit(e);else if(e.columns){var n=function e(t,o){if(Array.isArray(t)||t.hasOwnProperty("list")||t.hasOwnProperty("columns")){var s=Array.isArray(t)?t:t.hasOwnProperty("list")?t.list:t.columns;s.length>0&&s.forEach((function(t){t.parent=o,t.columns&&t.columns.length>0?e(t.columns,o):t.list&&t.list.length>0?e(t.list,o):t.hasOwnProperty("list")||t.hasOwnProperty("columns")||i.formItemDataInit(t)}))}else t.parent=o,i.formItemDataInit(t)},i=this;n(e.columns,e.model)}},initFormWitheValue:function(e){this.initFormDate=e,this.toSetFormItemData(this.formItemList)},fixMax:function(e,t){function o(e,s){e.forEach((function(e){e.id=e.value,e.text=e.label,e.floor=s,t>s&&!e.children&&(e.children=[]),e.children&&e.children.length>0&&o(e.children,s+1)}))}o(e,1)},getMaxFloor:function(e){var t=0;function o(e,s){e.forEach((function(e){e.id=e.value,e.text=e.label,e.floor=s,s>t&&(t=s),e.children&&e.children.length>0&&o(e.children,s+1)}))}return o(e,1),t},onFailed:function(e){console.log("failed",e)},asyncValidator:function(e,t){return new Promise((function(o){var s=!!t.options.hasOwnProperty("required")&&t.options.required;o(!s||""!==e&&"undefined"!==e)}))},getSelectedColumns:function(e){for(var t in e)if(this.selectedColumns.get(t)){var o=this.selectedColumns.get(t);Array.isArray(o)?function(){var s=[],n=[];o.forEach((function(e){s.push(e.value),n.push(e.label)})),e[t]={value:s.join(","),label:n.join(",")}}():e[t]=o}},weatherPass:function(e,t){try{!e.options.required||""!==t&&t!==[]||this.ignoreRule||(this.formErrorMsg="请输入必填项: "+e.name)}catch(o){console.error(JSON.stringify(e))}},onSubmit:function(e){var t=this;this.formErrorMsg="";var o=JSON.parse(JSON.stringify(e)),s=[];for(var n in"{}"!==JSON.stringify(this.kidFromItem)&&(s=JSON.parse(JSON.stringify(this.kidFromItem.tableColumns)),s=s.map((function(e){return e.model}))),o)if(s.includes(n))delete o[n];else{var i=this.formItemMap.get(n),a=JSON.parse(JSON.stringify(o[n]));"undefined"!==n&&this.weatherPass(i,a)}if(this.getSelectedColumns(o),this.kidFromValue){var r=JSON.parse(JSON.stringify(this.kidFromValue));o[this.kidFromItem.model]=r.map((function(e){var o={};e.map((function(e){var s={};if(o[e.model]=e.options.defaultValue,t.selectedColumns.get(e.key)){var n=t.selectedColumns.get(e.key);if(Array.isArray(n)){var i=[],a=[];n.forEach((function(e){i.push(e.value),a.push(e.label)})),o[e.model]={value:i.join(","),label:a.join(",")}}else o[e.model]=n}return s}));return o}))}var l={error:this.formErrorMsg,formData:o},c=JSON.stringify(l,null,4),u=c.replace(/\n/g,"<br>").replace(/\s/g,"&nbsp");this.formResult=u,this.$emit("submitResult",l)},format:function(e,t){var o={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var s in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?o[s]:("00"+o[s]).substr((""+o[s]).length)));return t},timePickerClick:function(e){e.options.disabled||this.formReadOnly||(this.showTimePicker=!0,this.timePickerItem=e,this.toTrigger("click",this.timePickerItem))},onPickerConfirm:function(e){var t=this.format(new Date(e),"yyyy-MM-dd hh:mm");this.timePickerItem.options.defaultValue=t,this.showTimePicker=!1,this.toTrigger("change",this.timePickerItem)},SelectPickerClick:function(e){this.selectPickerItem=e,this.selectColumns={};var t=Array.isArray(e.options.value)?JSON.parse(JSON.stringify(e.options.value)):e.options.value.split(",");if(this.PickerItemValue=t,!e.options.disabled&&!this.formReadOnly){this.pickerLoading=!0,this.showPopup=!0,e.options.multiple?this.showMultiplePicker=!0:this.showSelectPicker=!0;var o=this.columnsMap.get(e.key)?this.columnsMap.get(e.key):[];if(e.options.remote){if(e.options.remote&&"option"==e.options.remoteType){var s=this.optionList[e.options.remoteOption];if(s&&s.length>0)this.selectColumns=s.map((function(e){return e.id=e.value,e.text=e.label,e})),this.columnsMap.set(e.key,JSON.parse(JSON.stringify(this.selectColumns))),this.pickerLoading=!1;else{if(s=this.initFormDate.hasOwnProperty(e.model)?this.initFormDate[e.model].value||""==this.initFormDate[e.model].value?"string"==typeof e.options.defaultValue?this.initFormDate[e.model].value:this.initFormDate[e.model].value.split(","):this.initFormDate[e.model]:e.options.defaultValue?e.options.defaultValue:[],s&&s.length>0){if(s instanceof Array&&this.initFormDate.hasOwnProperty(e.model)){var n=this.initFormDate[e.model].label.split(","),i=[];s.forEach((function(e,t){if(""!==e){var o={id:e,text:n[t]};i.push(o)}})),this.selectColumns=""==this.initFormDate[e.model].value?[]:i}}else this.selectColumns=[];this.columnsMap.set(e.key,JSON.parse(JSON.stringify(this.selectColumns))),this.pickerLoading=!1}}if(!e.options.remote||"func"!=e.options.remoteType||this.loadFunList.includes(e.key)&&0!=o.length){if(e.options.remote&&"func"==e.options.remoteType){if(o){var a=JSON.parse(JSON.stringify(o));a&&(this.selectColumns=a)}else this.selectColumns=[];this.pickerLoading=!1,vant__WEBPACK_IMPORTED_MODULE_21__["a"].clear()}}else try{var r=this;window[e.options.remoteFunc]().then((function(t){r.selectColumns=t.list.options.map((function(e){return e.id=e.value,e.text=e.label,e})),r.loadFunList.push(e.key),r.columnsMap.set(e.key,JSON.parse(JSON.stringify(r.selectColumns))),r.pickerLoading=!1}))}catch(c){vant__WEBPACK_IMPORTED_MODULE_21__["a"].fail("加载下拉失败"),this.pickerLoading=!1,this.showSelectPicker=!1,this.showMultiplePicker=!1,this.showPopup=!1,this.columnsMap.set(e.key,[]),console.log(c)}}else{var l=JSON.parse(JSON.stringify(o));this.selectColumns=l,this.pickerLoading=!1}this.toTrigger("click",e)}},onSelectConfirm:function(e){if(Array.isArray(e)){var t=function t(o){o.forEach((function(o){if(e[o.floor-1]===o.label){var n={value:o.value,label:o.label};s.push(n),o.children&&o.children.length>0&&e[o.floor]&&t(o.children)}}))},o=JSON.parse(JSON.stringify(this.selectColumns)),s=[];t(o),e=e.filter((function(e){return e})).join(","),this.selectedColumns.set(this.selectPickerItem.model,s),this.selectedColumns.set(this.selectPickerItem.key,s),this.selectPickerItem.options.defaultValue=e}else this.selectedColumns.set(this.selectPickerItem.model,e),this.selectedColumns.set(this.selectPickerItem.key,e),this.selectPickerItem.options.defaultValue=e.text;this.showSelectPicker=!1,this.showMultiplePicker=!1,this.showPopup=!1,this.toTrigger("change",this.selectPickerItem)},onSelectConcancel:function(){this.showPopup=!1,this.showMultiplePicker=!1,this.showSelectPicker=!1,this.selectPickerItem={},this.searchValue="",this.PickerItemValue=""},onSearch:function(){var e=this;if(""!==this.searchValue){var t=JSON.parse(JSON.stringify(this.columnsMap.get(this.selectPickerItem.key)));this.selectColumns=t?t.filter((function(t){return t.text.toLocaleLowerCase().includes(e.searchValue.toLocaleLowerCase())})):[]}else this.onSearchCancel()},onSearchCancel:function(){var e=JSON.parse(JSON.stringify(this.columnsMap.get(this.selectPickerItem.key)));this.selectColumns=e||[]},chooseMultipleItem:function(e){if(this.selectPickerItem.options.multiple)if(this.PickerItemValue.includes(e)){var t=this.PickerItemValue.indexOf(e);this.PickerItemValue.splice(t,1)}else this.PickerItemValue.push(e);else this.PickerItemValue=[e]},onMultipleConfirm:function(){this.selectPickerItem.options.value=this.PickerItemValue.join(",");var e=JSON.parse(JSON.stringify(this.selectColumns)),t=[],o=[],s=this;function n(e){e.forEach((function(e){s.PickerItemValue.includes(e.value)&&(o.push({value:e.value,label:e.label}),t.push(e.label),e.children&&e.children.length>0&&t.length<s.PickerItemValue.length&&n(e.children))}))}n(e),this.selectedColumns.set(this.selectPickerItem.model,o),this.selectedColumns.set(this.selectPickerItem.key,o),this.selectPickerItem.options.defaultValue=t.join(","),this.toTrigger("change",this.selectPickerItem),this.onSelectConcancel()},afterRead:function(e,t,o){if(!o){vant__WEBPACK_IMPORTED_MODULE_21__["a"].loading({duration:0,message:"上传中...",forbidClick:!0,loadingType:"spinner"}),e.status="uploading",e.message="上传中...";var s=new FormData;for(var n in this.fileData)s.append(n,this.fileData[n]);s.append("file",e.file);this.submitDisabled=!0;var i=this.urls.restUpload,a=window.config.baseUrl;i=a+i;var r=new XMLHttpRequest;r.onreadystatechange=function(o){if(4==r.readyState&&200==r.status){var s=JSON.parse(r.responseText);this.submitDisabled=!1,0==s.errorCode?(e.status="done",e.message="上传成功",e.uuid=s.responseBody.uuid):(e.status="failed",e.message="上传失败"),setTimeout((function(){t=t.filter((function(e){return"failed"!==e.status}))}),1e3),vant__WEBPACK_IMPORTED_MODULE_21__["a"].clear()}},r.open("POST",i,!0);var l=window.localStorage.getItem("accessToken");l&&r.setRequestHeader("token",l),r.send(s)}},beforeDelete:function(e,t,o){o||(vant__WEBPACK_IMPORTED_MODULE_21__["a"].loading({duration:0,message:"删除中...",forbidClick:!0,loadingType:"spinner"}),this.postAxios(this.urls.restDelete,{uuid:e.uuid}).then((function(o){if(0===o.errorCode){var s=0;t.map((function(t,o){t.uuid==e.uuid&&(s=o)})),t.splice(s,1),vant__WEBPACK_IMPORTED_MODULE_21__["a"].clear(),vant__WEBPACK_IMPORTED_MODULE_21__["a"].success("删除成功")}else vant__WEBPACK_IMPORTED_MODULE_21__["a"].clear(),vant__WEBPACK_IMPORTED_MODULE_21__["a"].fail(o.message)})))},editorChange:function(e,t){t.options.defaultValue=e},addColumns:function(){var e=this,t=JSON.parse(JSON.stringify(this.kidFromItem.tableColumns));t.map((function(t){return e.loadTheOptions(t),t.key=e.kidFromItem.model+"/"+t.model,t})),this.kidFromValue.push(t)},delectColumns:function(e){this.kidFromValue.splice(e,1)}}}},2532:function(e,t,o){"use strict";var s=o("23e7"),n=o("5a34"),i=o("1d80"),a=o("ab13");s({target:"String",proto:!0,forced:!a("includes")},{includes:function(e){return!!~String(i(this)).indexOf(n(e),arguments.length>1?arguments[1]:void 0)}})},2863:function(e,t,o){},4690:function(e,t,o){e.exports=o.p+"img/nullcontent.57791ffb.png"},"4d63":function(e,t,o){var s=o("83ab"),n=o("da84"),i=o("94ca"),a=o("7156"),r=o("9bf2").f,l=o("241c").f,c=o("44e7"),u=o("ad6d"),d=o("9f7f"),p=o("6eeb"),_=o("d039"),f=o("69f3").set,m=o("2626"),h=o("b622"),g=h("match"),y=n.RegExp,v=y.prototype,b=/a/g,k=/a/g,I=new y(b)!==b,D=d.UNSUPPORTED_Y,O=s&&i("RegExp",!I||D||_((function(){return k[g]=!1,y(b)!=b||y(k)==k||"/a/i"!=y(b,"i")})));if(O){var w=function(e,t){var o,s=this instanceof w,n=c(e),i=void 0===t;if(!s&&n&&e.constructor===w&&i)return e;I?n&&!i&&(e=e.source):e instanceof w&&(i&&(t=u.call(e)),e=e.source),D&&(o=!!t&&t.indexOf("y")>-1,o&&(t=t.replace(/y/g,"")));var r=a(I?new y(e,t):y(e,t),s?this:v,w);return D&&o&&f(r,{sticky:o}),r},x=function(e){e in w||r(w,e,{configurable:!0,get:function(){return y[e]},set:function(t){y[e]=t}})},N=l(y),P=0;while(N.length>P)x(N[P++]);v.constructor=w,w.prototype=v,p(n,"RegExp",w)}m("RegExp")},"626b":function(e,t,o){"use strict";var s=o("2863"),n=o.n(s);n.a},"8e59":function(e,t,o){"use strict";var s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"editor"},[o("div",{ref:"toolbar",staticClass:"toolbar"}),o("div",{ref:"editor",staticClass:"text"})])},n=[],i=o("1a0b"),a=o.n(i),r={name:"editoritem",data:function(){return{editor:null,info_:null}},model:{prop:"value",event:"change"},props:{value:{type:String,default:""},isClear:{type:Boolean,default:!1}},watch:{isClear:function(e){e&&(this.editor.txt.clear(),this.info_=null)},value:function(e){e!==this.editor.txt.html()&&this.editor.txt.html(this.value)}},mounted:function(){this.seteditor(),this.editor.txt.html(this.value)},methods:{seteditor:function(){var e=this;this.editor=new a.a(this.$refs.toolbar,this.$refs.editor),this.editor.customConfig.uploadImgShowBase64=!1,this.editor.customConfig.uploadImgServer=this.urls.restUpload,this.editor.customConfig.uploadImgHeaders={},this.editor.customConfig.uploadFileName="file",this.editor.customConfig.uploadImgMaxSize=2097152,this.editor.customConfig.uploadImgMaxLength=6,this.editor.customConfig.uploadImgTimeout=18e4,this.editor.customConfig.menus=["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","table","video","code","undo","redo","fullscreen"],this.editor.customConfig.uploadImgHooks={fail:function(e,t,o){},success:function(e,t,o){},timeout:function(e,t){},error:function(e,t){},customInsert:function(e,t,o){var s=window.config.baseUrl+t.url;e(s)}},this.editor.customConfig.onchange=function(t){e.info_=t,e.$emit("change",e.info_)},this.editor.create()}}},l=r,c=(o("626b"),o("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);t["a"]=u.exports},"9e48":function(e,t,o){"use strict";var s=o("e1c0"),n=o.n(s);n.a},b85c:function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));o("a4d3"),o("e01a"),o("d28b"),o("e260"),o("d3b7"),o("3ca3"),o("ddb0");var s=o("06c5");function n(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=Object(s["a"])(e))){var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i,a=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){r=!0,i=e},f:function(){try{a||null==n["return"]||n["return"]()}finally{if(r)throw i}}}}},c0b9:function(e,t,o){"use strict";o.r(t);var s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("section",{staticClass:"workflowDetali"},[e.nextNode||"抢单"===e.curNodeType?e._e():o("van-notice-bar",{attrs:{color:"#1989fa",background:"#ecf9ff","left-icon":"info-o"}},[e._v(" 该表单下一节点为空。 ")]),o("van-tabs",{on:{change:e.tabsChange},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[o("van-tab",{attrs:{title:"表单处理"}},[o("section",{staticClass:"workflowForm"},[o("FormByJson",{ref:"iframeWindowApp",attrs:{formKey:e.theFormKey,formReadOnly:e.isReadOnly,fileData:e.fileData,BaseInfo:e.processInfo},on:{submitResult:e.showResult}}),o("div",{attrs:{id:"formSubmit"}},["add"===e.$route.query.formDaoType?o("section",[o("van-button",{attrs:{round:"",block:"",type:"info",loading:e.submissionLoading},on:{click:function(t){return e.nextStep()}}},[e._v("保存")])],1):o("section",[o("div",{directives:[{name:"show",rawName:"v-show",value:!e.showPopup&&!e.isReadOnly&&e.loadTheInfo,expression:"!showPopup && !isReadOnly && loadTheInfo"}],staticClass:"formSubmitBtns"},["抢单"===e.curNodeType?o("van-button",{staticStyle:{width:"80%",margin:"auto"},attrs:{round:"",block:"",type:"info"},on:{click:e.receipt}},[e._v("抢单")]):"会签"===e.curNodeType?o("div",{staticClass:"nomalDao"},[o("van-button",{staticClass:"Dao",attrs:{round:"",block:"",type:"info",size:"small"},on:{click:function(t){e.formDao="countersignDealTask",e.nextStep()}}},[e._v("会签处理")])],1):"审核挂起"===e.curNodeName?o("div",{staticClass:"nomalDao"},[o("van-button",{staticClass:"Dao",attrs:{round:"",block:"",type:"info",size:"small"},on:{click:function(t){e.formDao="hangUpTaskExamine",e.nextStep()}}},[e._v("审核挂起")]),o("van-button",{staticClass:"Dao",attrs:{round:"",block:"",type:"warning",size:"small"},on:{click:function(t){e.formDao="hangUpTaskBack",e.nextStep()}}},[e._v("退回")])],1):"挂起"===e.curNodeName?o("div",{staticClass:"nomalDao"},[o("van-button",{staticClass:"Dao",attrs:{round:"",block:"",type:"info",size:"small"},on:{click:function(t){e.formDao="hangUpTaskRelieve",e.nextStep()}}},[e._v("解除挂起")])],1):o("div",{staticClass:"nomalDao"},[o("van-button",{staticClass:"Dao",attrs:{round:"",block:"",type:"primary",size:"small"},on:{click:function(t){e.toTaskSave=!0,e.nextStep(!0)}}},[e._v("暂存")]),o("van-button",{staticClass:"Dao",attrs:{round:"",block:"",type:"info",size:"small"},on:{click:function(t){e.formDao="agree",e.nextStep()}}},[e._v("同意")]),e.backToNode?o("van-button",{staticClass:"Dao",attrs:{round:"",block:"",type:"warning",size:"small"},on:{click:function(t){e.formDao="reject",e.backNodeLists()}}},[e._v("退回")]):e._e(),e.transfer?o("van-button",{staticClass:"Dao",attrs:{round:"",block:"",type:"info",size:"small"},on:{click:function(t){e.formDao="forward",e.showPopup=!0}}},[e._v("转发")]):e._e()],1)],1),o("van-button",{directives:[{name:"show",rawName:"v-show",value:e.isReadOnly&&e.loadTheInfo,expression:"isReadOnly && loadTheInfo"}],attrs:{round:"",block:"",type:"info",size:"small"},on:{click:e.backTop}},[e._v("返回")])],1)]),o("section",{staticClass:"popupBox"},[o("van-popup",{attrs:{closeable:"",position:"bottom"},model:{value:e.showPopup,callback:function(t){e.showPopup=t},expression:"showPopup"}},["抢单"!==e.curNodeType?o("van-cell-group",{staticClass:"handelBox"},["会签"===e.nextNodeType||"级联审批"===e.nextNodeType?o("div",[o("van-field",{attrs:{label:"下一节点:",placeholder:"",readonly:"",clickable:""},on:{click:function(t){return e.selectNextNode()}},model:{value:e.nextNodeName,callback:function(t){e.nextNodeName=t},expression:"nextNodeName"}}),"结束"===e.nextNodeType||"无需选择处理人"===e.nextNodeType||e.noUser?e._e():o("van-field",{attrs:{label:"下一步处理人:",placeholder:"",readonly:"",clickable:""},on:{click:function(t){return e.selectNextHandel()}},model:{value:e.nextAssigneeIds,callback:function(t){e.nextAssigneeIds=t},expression:"nextAssigneeIds"}})],1):o("div",["agree"==e.formDao?o("van-field",{attrs:{label:"下一节点:",placeholder:"",readonly:"",clickable:""},on:{click:function(t){return e.selectNextNode()}},model:{value:e.nextNodeName,callback:function(t){e.nextNodeName=t},expression:"nextNodeName"}}):e._e(),"reject"===e.formDao?o("div",[o("van-field",{attrs:{label:"退回节点:",placeholder:"",readonly:"",clickable:""},on:{click:function(t){return e.selectRejectNodeList()}},model:{value:e.targetTaskDefKey,callback:function(t){e.targetTaskDefKey=t},expression:"targetTaskDefKey"}})],1):e._e(),"reject"!==e.formDao&&"hangUpTaskBack"!==e.formDao?o("div",["结束"!==e.nextNodeType&&"无需选择处理人"!==e.nextNodeType&&!e.noUser||"forward"==e.formDao?o("van-field",{attrs:{label:"下一步处理人:",placeholder:"",readonly:"",clickable:""},on:{click:function(t){return e.selectNextAssignee()}},model:{value:e.nextAssigneeIds,callback:function(t){e.nextAssigneeIds=t},expression:"nextAssigneeIds"}}):e._e()],1):e._e()],1),o("van-field",{attrs:{label:"流程意见:",placeholder:""},model:{value:e.processOpinion,callback:function(t){e.processOpinion=t},expression:"processOpinion"}})],1):o("van-cell-group",{staticClass:"handelBox qiangdan"},[o("van-button",{staticStyle:{width:"80%",margin:"auto"},attrs:{round:"",block:"",type:"info"},on:{click:e.receipt}},[e._v("抢单")])],1),"抢单"!==e.curNodeType?o("div",{staticClass:"handelDao"},[o("van-button",{attrs:{round:"",block:"",type:"info",loading:e.submissionLoading},on:{click:e.submission}},[e._v("提交")])],1):e._e()],1),o("van-popup",{attrs:{position:"bottom"},model:{value:e.nextNodePopup,callback:function(t){e.nextNodePopup=t},expression:"nextNodePopup"}},[o("van-picker",{attrs:{"show-toolbar":"",columns:e.nextNode},on:{confirm:e.onConfirm,cancel:function(t){e.nextNodePopup=!1}}})],1),o("van-popup",{attrs:{position:"bottom"},model:{value:e.rejectNodePopup,callback:function(t){e.rejectNodePopup=t},expression:"rejectNodePopup"}},[o("van-picker",{attrs:{"show-toolbar":"",columns:e.rejectNodeList},on:{confirm:e.onRejectNodeConfirm,cancel:function(t){e.rejectNodePopup=!1}}})],1),o("van-popup",{attrs:{position:"bottom"},model:{value:e.nextAssigneePopup,callback:function(t){e.nextAssigneePopup=t},expression:"nextAssigneePopup"}},[o("section",{staticClass:"content"},[o("div",{staticClass:"van-hairline--top-bottom van-picker__toolbar"},[o("button",{staticClass:"van-picker__cancel",attrs:{type:"button"},on:{click:function(t){e.nextAssigneePopup=!1}}},[e._v("取消")]),o("div",{staticClass:"van-ellipsis van-picker__title"},[e._v(e._s(0==e.current?"部门":"用户"))]),o("button",{staticClass:"van-picker__confirm",attrs:{type:"button"},on:{click:function(t){e.nextAssigneePopup=!1}}},[e._v("确认")])]),o("van-swipe",{ref:"roleChoose",attrs:{loop:!1},on:{change:e.onChange},scopedSlots:e._u([{key:"indicator",fn:function(){return[o("div",{staticClass:"custom-indicator"})]},proxy:!0}])},[e.userOnly?e._e():o("van-swipe-item",[o("div",{staticClass:"MultipleBox"},e._l(e.roleList,(function(t){return o("div",{key:t.uuid,class:{choosed:e.nextAssigneeIdArry.includes(t.text),MultipleItem:!0},on:{click:function(o){return e.chooseNextRole(t)}}},[o("div",[e._v(e._s(t.text))])])})),0)]),o("van-swipe-item",[o("div",{staticClass:"MultipleBox"},[e._l(e.userList,(function(t){return o("div",{directives:[{name:"show",rawName:"v-show",value:!e.userLoading,expression:"!userLoading"}],key:t.id,class:{choosed:e.nextAssigneeIdArry.includes(t.text),MultipleItem:!0},on:{click:function(o){return e.onNextAssigneeConfirm(t)}}},[o("div",[e._v(e._s(t.text))])])})),o("div",{directives:[{name:"show",rawName:"v-show",value:0==e.userList.length,expression:"userList.length == 0"}]},[e.userLoading?o("span",[e._v("加载中")]):o("span",[e._v("暂无数据")])])],2)])],1)],1)])],1)],1)]),o("van-tab",{attrs:{title:"流程图"}},[o("section",{staticClass:"processInstNewImageBox"},[e._l(e.nodeInfoList,(function(t,s){return o("div",{key:t.nodeName+s,class:{curFlowImg:!t.endTime,processInstItem:!0},style:{width:t.width+10+"px",height:t.height+10+"px",left:t.x-5+"px",top:t.y-5+"px"}},[o("span",{staticClass:"indexBox"},[e._v(" "+e._s(e.nodeInfoListMap.get(t.x+"|"+t.y).join(","))+" ")])])})),o("img",{staticClass:"processInstNewImage",attrs:{src:""==e.processInstNewImage?e.nullcontent:"data:image/png;base64,"+e.processInstNewImage}})],2)]),o("van-tab",{attrs:{title:"关联工单"}},[0==e.dataSource.length?o("section",{staticClass:"nullContent"},[o("img",{staticClass:"processInstNewImage",staticStyle:{"max-width":"100%"},attrs:{src:e.nullcontent}})]):o("section",{staticClass:"dataSourceBox"},e._l(e.dataSource,(function(t){return o("div",{key:t.workNumber,staticClass:"dataSourceItem"},[o("section",{staticClass:"eventBox"},[o("div",{staticClass:"workflowTitle"},[e._v("流程名称:"+e._s(t.processName))]),o("div",{staticClass:"workflowContent"},[o("div",{staticClass:"ContentItem"},[e._v("工单编号:"+e._s(t.workNumber))]),o("div",{staticClass:"ContentItem"},[e._v("创建人:"+e._s(t.createUser))]),o("div",{staticClass:"ContentItem"},[e._v("流程描述:"+e._s(t.processDesc))]),o("div",{staticClass:"ContentItem"},[e._v("当前节点:"+e._s(t.activityName))]),o("div",{staticClass:"ContentItem"},[e._v("当前处理人/角色:"+e._s(t.handleUser))]),o("div",{staticClass:"ContentItem"},[e._v("送达时间:"+e._s(t.activityTime))])])])])})),0)]),o("van-tab",{attrs:{title:"流程日志"}},[o("van-steps",{attrs:{direction:"vertical",active:0}},e._l(e.basicFlowInstanceLogList,(function(t){return o("van-step",{key:t.nodeId},[o("h3",[e._v(e._s(t.nodeName))]),o("h3",[e._v(e._s(t.userName)+"("+e._s(t.key)+")")]),o("p",[e._v(e._s(t.dealTime))])])})),1)],1)],1)],1)},n=[],i=(o("99af"),o("4de4"),o("7db0"),o("4160"),o("a15b"),o("d81d"),o("a434"),o("b0c0"),o("4ec9"),o("d3b7"),o("ac1f"),o("3ca3"),o("1276"),o("159b"),o("ddb0"),o("2909")),a=o("5530"),r=o("4690"),l=o.n(r),c=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("section",{staticClass:"formByJson"},[o("van-form",{ref:"formByJson",attrs:{"validate-first":"",colon:""},on:{failed:e.onFailed,submit:e.onSubmit}},[o("section",{staticClass:"formContentBox"},[e._l(e.formItemData,(function(t,s){return o("div",{key:s,class:{formItem:!0,require:t.options.required||e.requiredList.includes(t.model),disable:t.options.disabled||"processAudit"==t.type||"processAuditTime"==t.type||"processAuditComments"==t.type||"processRelationWorkNum"==t.type||e.formReadOnly}},["divider"!==t.type||t.options.hidden?e._e():o("van-divider",[e._v(e._s(t.name))]),"input"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{readonly:t.options.disabled||e.formReadOnly,name:t.model,label:t.name,type:t.options.dataType,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},on:{click:function(o){return e.toTrigger("click",t)},blur:function(o){return e.toTrigger("blur",t)},focus:function(o){return e.toTrigger("focus",t)}},model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}}),"textarea"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{readonly:t.options.disabled||e.formReadOnly,name:t.model,label:t.name,type:"textarea",rows:"2",autosize:"",rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},on:{click:function(o){return e.toTrigger("click",t)},blur:function(o){return e.toTrigger("blur",t)},focus:function(o){return e.toTrigger("focus",t)}},model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}}),"processAudit"!=t.type&&"processAuditTime"!=t.type||t.options.hidden?e._e():o("van-field",{attrs:{readonly:t.options.disabled||"processAudit"==t.type||"processAuditTime"==t.type||e.formReadOnly,name:t.model,label:t.name,type:t.options.dataType,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},on:{click:function(o){return e.toTrigger("click",t)},blur:function(o){return e.toTrigger("blur",t)},focus:function(o){return e.toTrigger("focus",t)}},model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}}),"processAuditComments"!=t.type&&"processRelationWorkNum"!=t.type||t.options.hidden?e._e():o("van-field",{attrs:{readonly:t.options.disabled||"processAuditComments"==t.type||"processRelationWorkNum"==t.type||e.formReadOnly,name:t.model,label:t.name,type:"textarea",rows:"2",autosize:"",rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},on:{click:function(o){return e.toTrigger("click",t)},blur:function(o){return e.toTrigger("blur",t)},focus:function(o){return e.toTrigger("focus",t)}},model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}}),"date"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{readonly:"",clickable:"",value:t.options.defaultValue,name:t.model,label:t.name,placeholder:"点击选择"+t.name,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},on:{click:function(o){return e.timePickerClick(t)}}}),"select"!==t.type&&"cascader"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{"get-container":"formByJson",readonly:"",clickable:"",value:t.options.defaultValue,name:t.model,label:t.name,placeholder:"点击选择"+t.name,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},on:{click:function(o){return e.SelectPickerClick(t)}}}),"radio"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{name:t.model,label:t.name,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},scopedSlots:e._u([{key:"input",fn:function(){return[o("van-radio-group",{attrs:{disabled:t.options.disabled||e.formReadOnly,direction:"horizontal"},on:{change:function(o){return e.toTrigger("change",t)}},model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}},e._l(t.options.options,(function(s,n){return o("van-radio",{key:t.key+n,attrs:{name:s.value}},[e._v(e._s(s.label))])})),1)]},proxy:!0}],null,!0)}),"checkbox"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{name:t.model,label:t.name,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},scopedSlots:e._u([{key:"input",fn:function(){return[o("van-checkbox-group",{attrs:{disabled:t.options.disabled||e.formReadOnly,direction:"horizontal"},on:{change:function(o){return e.toTrigger("change",t)}},model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}},e._l(t.options.options,(function(s,n){return o("van-checkbox",{key:t.key+n,attrs:{name:s.id,shape:"square"}},[e._v(e._s(s.text))])})),1)]},proxy:!0}],null,!0)}),"fileupload"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{name:t.model,label:t.name,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},scopedSlots:e._u([{key:"input",fn:function(){return[o("van-uploader",{attrs:{disabled:t.options.disabled||e.formReadOnly,name:"file","after-read":function(o){e.afterRead(o,t.options.defaultValue,t.options.disabled)},"before-delete":function(o){e.beforeDelete(o,t.options.defaultValue,t.options.disabled)}},model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}})]},proxy:!0}],null,!0)}),"editor"!==t.type||t.options.hidden?e._e():o("van-field",{staticClass:"blockField",attrs:{name:t.model,label:t.name,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},scopedSlots:e._u([{key:"input",fn:function(){return[o("section",[t.options.disabled||e.formReadOnly?o("div",{staticClass:"textArea",domProps:{innerHTML:e._s(t.options.defaultValue)}}):o("editor-bar",{attrs:{isClear:!1,value:t.options.defaultValue},on:{change:function(o){e.editorChange(o,t)}}})],1)]},proxy:!0}],null,!0),model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}})],1)})),e.kidFromItem&&e.kidFromItem.name?o("section",[o("van-divider",[e._v(e._s(e.kidFromItem.name))]),o("div",{staticClass:"kidFromItemDao"},[o("a",{attrs:{type:"info",size:"small"},on:{click:e.addColumns}},[e._v("添加")])]),e.kidFromValue?o("van-collapse",{staticClass:"kidCollapse",attrs:{accordion:""},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.kidFromValue,(function(t,s){return o("van-collapse-item",{key:s,attrs:{title:e.kidFromItem.name,border:"",name:s}},[e._l(t,(function(t,n){return o("section",{key:"kidIndex_"+s+"formItemIndex_"+n,class:{kidFromItem:!0,formItem:!0,require:t.options.required||e.requiredList.includes(t.model),disable:t.options.disabled||"processAudit"==t.type||"processAuditTime"==t.type||"processAuditComments"==t.type||"processRelationWorkNum"==t.type||e.formReadOnly}},["fileupload"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{name:t.model,label:t.name,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},scopedSlots:e._u([{key:"input",fn:function(){return[o("van-uploader",{attrs:{disabled:t.options.disabled||e.formReadOnly,name:"file","after-read":function(o){e.afterRead(o,t.options.defaultValue,t.options.disabled)},"before-delete":function(o){e.beforeDelete(o,t.options.defaultValue,t.options.disabled)}},model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}})]},proxy:!0}],null,!0)}),"input"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{readonly:t.options.disabled||e.formReadOnly,name:t.model,label:t.name,type:t.options.dataType,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},on:{click:function(o){return e.toTrigger("click",t)},blur:function(o){return e.toTrigger("blur",t)},focus:function(o){return e.toTrigger("focus",t)}},model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}}),"textarea"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{readonly:t.options.disabled||e.formReadOnly,name:t.model,label:t.name,type:"textarea",rows:"2",autosize:"",rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},on:{click:function(o){return e.toTrigger("click",t)},blur:function(o){return e.toTrigger("blur",t)},focus:function(o){return e.toTrigger("focus",t)}},model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}}),"date"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{readonly:"",clickable:"",value:t.options.defaultValue,name:t.model,label:t.name,placeholder:"点击选择"+t.name,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},on:{click:function(o){return e.timePickerClick(t)}}}),"select"!==t.type&&"cascader"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{"get-container":"formByJson",readonly:"",clickable:"",value:t.options.defaultValue,name:t.model,label:t.name,placeholder:"点击选择"+t.name,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},on:{click:function(o){return e.SelectPickerClick(t)}}}),"radio"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{name:t.model,label:t.name,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},scopedSlots:e._u([{key:"input",fn:function(){return[o("van-radio-group",{attrs:{disabled:t.options.disabled||e.formReadOnly,direction:"horizontal"},on:{change:function(o){return e.toTrigger("change",t)}},model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}},e._l(t.options.options,(function(t,s){return o("van-radio",{key:t.key+s,attrs:{name:t.value}},[e._v(e._s(t.label))])})),1)]},proxy:!0}],null,!0)}),"checkbox"!==t.type||t.options.hidden?e._e():o("van-field",{attrs:{name:t.model,label:t.name,rules:[{validator:function(o){e.asyncValidator(o,t)},message:"请输入"+t.name}]},scopedSlots:e._u([{key:"input",fn:function(){return[o("van-checkbox-group",{attrs:{disabled:t.options.disabled||e.formReadOnly,direction:"horizontal"},on:{change:function(o){return e.toTrigger("change",t)}},model:{value:t.options.defaultValue,callback:function(o){e.$set(t.options,"defaultValue",o)},expression:"formItem.options.defaultValue"}},e._l(t.options.options,(function(s,n){return o("van-checkbox",{key:t.key+n,attrs:{name:s.id,shape:"square"}},[e._v(e._s(s.text))])})),1)]},proxy:!0}],null,!0)})],1)})),o("van-button",{attrs:{round:"",block:"",type:"info"},on:{click:function(t){return e.delectColumns(s)}}},[e._v("删除")])],2)})),1):e._e()],1):e._e()],2),o("section",{staticClass:"popupBox"},[o("van-popup",{attrs:{position:"bottom"},model:{value:e.showTimePicker,callback:function(t){e.showTimePicker=t},expression:"showTimePicker"}},[o("van-datetime-picker",{attrs:{title:e.timePickerItem.name,type:e.timePickerItem.options?e.timePickerItem.options.type:"datetime","min-date":e.minDate,"max-date":e.maxDate},on:{confirm:e.onPickerConfirm,cancel:function(t){e.showTimePicker=!1,e.timePickerItem={},e.searchValue=""}}})],1),o("van-popup",{attrs:{position:"bottom"},model:{value:e.showPopup,callback:function(t){e.showPopup=t},expression:"showPopup"}},["cascader"===e.selectPickerItem.type?o("section",{staticClass:"content"},[e.showSelectPicker?o("van-picker",{attrs:{loading:e.pickerLoading,"show-toolbar":"","value-key":"label",title:e.selectPickerItem.name,columns:e.selectColumns},on:{confirm:e.onSelectConfirm,cancel:e.onSelectConcancel}}):e._e()],1):o("section",{staticClass:"content"},["cascader"!==e.selectPickerItem.type?o("van-search",{attrs:{placeholder:"请输入搜索关键词","input-align":"center"},on:{search:e.onSearch,cancel:e.onSearchCancel},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}):e._e(),"cascader"!==e.selectPickerItem.type?o("div",{staticClass:"van-hairline--top-bottom van-picker__toolbar"},[o("button",{staticClass:"van-picker__cancel",attrs:{type:"button"},on:{click:e.onSelectConcancel}},[e._v("取消")]),o("div",{staticClass:"van-ellipsis van-picker__title"},[e._v(e._s(e.selectPickerItem.name))]),o("button",{staticClass:"van-picker__confirm",attrs:{type:"button"},on:{click:e.onMultipleConfirm}},[e._v("确认")])]):e._e(),e.selectColumns?o("div",{staticClass:"MultipleBox"},e._l(e.selectColumns,(function(t,s){return o("div",{key:s,class:{choosed:e.PickerItemValue.includes(t.value),MultipleItem:!0},on:{click:function(o){return e.chooseMultipleItem(t.value)}}},[o("div",[e._v(e._s(t.label))])])})),0):e._e()],1)]),o("van-popup",{style:{height:"50%"},attrs:{closeable:"",position:"bottom"},model:{value:e.showResult,callback:function(t){e.showResult=t},expression:"showResult"}},[o("section",{staticClass:"formResult",domProps:{innerHTML:e._s(e.formResult)}})])],1)])],1)},u=[],d=o("13a1"),p=d["a"],_=(o("9e48"),o("2877")),f=Object(_["a"])(p,c,u,!1,null,"00078a9c",null),m=f.exports,h=o("f564"),g=o("d399"),y=o("28a2"),v=o("2f62"),b={name:"workflowDetali",data:function(){return{active:0,processInstNewImage:"",nullcontent:l.a,processOpinion:"",formDao:"agree",fileData:{},formDaoOptions:[{value:"agree",label:"同意"},{value:"reject",label:"退回"},{value:"forward",label:"转发"}],processInfo:{},formData:{},userInfo:{},theFormKey:"",nextNodePopup:!1,nextUsersPopup:!1,rejectNodePopup:!1,nextAssigneePopup:!1,userLoading:!1,nextHandel:{},flowHandle:{},curHandleName:"",curNodeType:"",curNodeName:"",curNode:null,nextNodeType:"",nextNodeName:"",nextNodeId:"",nextNodeAssignee:"",nextNode:null,basicFlowInstanceLogList:[],processInstanceId:"",rejectNodeList:[],nextUsers:[],uuid:"",opinionData:{processOpinion:"",targetTaskDefKey:"",nextAssignee:"",isAgree:"同意",lookUserInput:""},targetTaskDefKey:"",nextAssignee:[],nextAssigneeIds:"",nextAssigneeIdArry:[],roleList:[],userList:[],current:0,commonOpinions:["同意","不同意","请领导审批","请归档","请参考","请审批"],submissionLoading:!1,showUserInput:"",showPopup:!1,isReadOnly:!1,toTaskSave:!1,dataSource:[],loadTheInfo:!1,nodeInfoList:[],nodeInfoListMap:new Map,userOnly:!1,backToNode:!1,transfer:!1,noUser:!1}},watch:{nextNodeId:function(e){var t=this;if(e){var o=this.nextNode.find((function(e){return e.nodeId===t.nextNodeId}));o&&(this.noUser=!!o.hasOwnProperty("noUser")&&o.noUser,this.nextNodeName=o.nodeName,this.nextNodeType=o.nodeType,this.nextNodeAssignee=o.assignee?o.assignee:"",this.showUserInputMet(o))}},nextAssigneeIds:function(e){e&&(this.nextAssigneeIdArry=e.split(","))}},components:{FormByJson:m},computed:Object(a["a"])({},Object(v["c"])(["userMsg"])),beforeMount:function(){this.processInst(),this.userInfo=JSON.parse(localStorage.getItem("useMsg"))},mounted:function(){this.processInstanceId=this.$route.query.processInstanceId,this.uuid=this.$route.query.uuid},methods:{toImagePreview:function(){""!==this.processInstNewImage&&Object(y["a"])(["data:image/png;base64,"+this.processInstNewImage])},tabsChange:function(e){1==e&&this.processInstImage(),2==e&&this.listRelationship()},listRelationship:function(){var e=this;this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0});var t={uuid:this.uuid};this.postAxios(this.urls.query.listRelationship,t).then((function(t){var o=t;if(0===o.errorCode){var s=o.responseBody;s&&(s.sort((function(e,t){return new Date(e.activityTime).getTime()-new Date(t.activityTime).getTime()})),e.dataSource=s.map((function(e){var t={};return t.uuid=e.uuid,t.processKey=e.processKey,e.key=JSON.stringify(t),e})),console.log(e.dataSource))}else e.$toast.fail(o.message);e.$toast.clear()})).catch((function(t){e.$toast.clear(),console.error(t)}))},processInstImage:function(){var e=this;this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0});var t={processInstanceId:this.processInstanceId};this.postAxios(this.urls.query.processInstNewImage,t).then((function(t){var o=t;0===o.errorCode?(e.processInstNewImage=o.responseBody.img,e.nodeInfoList=o.responseBody.nodeInfo,e.nodeInfoList&&e.nodeInfoList.forEach((function(t,o){var s=e.nodeInfoListMap.get(t.x+"|"+t.y)?e.nodeInfoListMap.get(t.x+"|"+t.y):[];s.push(o+1),e.nodeInfoListMap.set(t.x+"|"+t.y,s)}))):e.$toast.fail(o.message),e.$toast.clear(),e.userLoading=!1})).catch((function(t){e.$toast.clear(),console.error(t)}))},onChange:function(e){this.current=e},selectNextHandel:function(){if(this.nextNode){var e=[];this.nextNode.forEach((function(t){e=[].concat(Object(i["a"])(e),Object(i["a"])(t.candidateGroups))})),e.length>0?(this.userOnly=!0,this.getCandidateGroups(e)):(this.userOnly=!1,this.getRole())}else this.userOnly=!1,this.getRole();this.nextAssigneePopup=!0,this.$refs.roleChoose&&this.$refs.roleChoose.swipeTo(0)},selectNextAssignee:function(){if(this.nextNode){var e=[];this.nextNode.forEach((function(t){e=[].concat(Object(i["a"])(e),Object(i["a"])(t.candidateGroups))})),e.length>0?(this.userOnly=!0,this.getCandidateGroups(e)):(this.userOnly=!1,this.getRole())}else this.userOnly=!1,this.getRole();this.nextAssigneePopup=!0},onNextAssigneeConfirm:function(e){var t=-1;for(var o in this.nextAssignee)if(this.nextAssignee[o].id===e.id){t=o;break}-1===t?this.nextAssignee.push(e):this.nextAssignee.splice(t,1);var s=[],n=[];this.nextAssignee.map((function(e){s.push(e.text),n.push(e.id)})),this.nextAssigneeIds=s.join(","),this.opinionData.nextAssignee=n.join(",")},chooseNextRole:function(e){this.$refs.roleChoose.next(),this.getAllUserList(e)},getCandidateGroups:function(e){var t=this;this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0}),this.userLoading=!0,this.postAxios(this.urls.query.getUserInfoByGroup,{group:e}).then((function(e){var o=e;0===o.errorCode?t.userList=o.responseBody.map((function(e){return e.text=e.label,e.id=e.value,e})):t.$toast.fail(o.message),t.$toast.clear(),t.userLoading=!1})).catch((function(e){t.$toast.clear(),console.error(e)}))},getRole:function(){var e=this;this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0}),this.userLoading=!0,this.postAxios(this.urls.role.all,{}).then((function(t){var o=t;0===o.errorCode?e.roleList=o.responseBody.map((function(e){return e.id=e.uuid,e.text=e.name,e})):e.$toast.fail(o.message),e.$toast.clear(),e.userLoading=!1})).catch((function(t){e.$toast.clear(),console.error(t)}))},getAllUserList:function(e){var t=this;this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0}),this.userLoading=!0;var o={id:e.id,roleId:e.id};this.postAxios(this.urls.role.searchUserByRoleId,o).then((function(e){var o=e;0===o.errorCode?t.userList=o.responseBody.map((function(e){return e.text=e.realname,e})):t.$toast.fail(o.message),t.$toast.clear(),t.userLoading=!1})).catch((function(e){t.$toast.clear(),console.error(e)}))},formDaoChange:function(e){var t=this;if("agree"===e){var o=this.nextNode.find((function(e){return e.nodeType===t.nextNodeType}));this.showUserInputMet(o)}else"reject"===e?this.backNodeLists():"forward"===e&&(this.getRole(),this.showUserInputMet(this.curNode))},selectNextNode:function(){this.nextNodePopup=!0},selectRejectNodeList:function(){this.rejectNodePopup=!0},selectNextUsers:function(){},onRejectNodeConfirm:function(e){this.opinionData.targetTaskDefKey=e.nodeTaskDefinitionKey,this.targetTaskDefKey=e.nodeName,this.rejectNodePopup=!1},onConfirm:function(e){this.nextNodeId=e.id,this.nextNodePopup=!1},nextStep:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.iframeWindowApp.toSubmit(e)},showResult:function(e){""!==e.error?Object(h["a"])({type:"warning",message:e.error}):(this.formData=JSON.parse(JSON.stringify(e.formData)),this.toTaskSave?this.taskSave():this.showPopup=!0)},agree:function(){var e=this.formData;"会签"===this.nextNodeType||"级联审批"===this.nextNodeType?this.multipleDealTask(e):"抢单"===this.nextNodeType?this.receiptDealTask(e):"子流程"===this.nextNodeType?this.callActivity(e):this.nextDealTask(e)},backTop:function(){this.$router.push({path:"/formByJson"})},taskSave:function(){var e=this;this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0});var t={};t.processKey=this.flowHandle.processKey,t.processOpinion=this.processOpinion,t.processInstanceId=this.flowHandle.processInstanceId,t.taskId=this.flowHandle.taskId,t.variables=this.$refs.iframeWindowApp.onVariablesSubmit(),t.formData=this.formData,this.postAxios(this.urls.task.save,t).then((function(t){e.$toast.clear();var o=t;0===o.errorCode?(e.$toast.success(o.message),setTimeout((function(){e.$router.push({path:"/formByJson"})}),1e3)):e.$toast.fail(o.message)})).catch((function(t){e.$toast.clear(),console.error(t)}))},nextDealTask:function(e){var t=this;this.submissionLoading=!0;var o={};o.nodeType=this.curNodeType,o.nextNodeType=this.nextNodeType,o.processKey=this.flowHandle.processKey,o.processOpinion=this.processOpinion,"会签"!==this.curNodeType&&"级联审批"!==this.curNodeType||(o.processOpinion="".concat(this.opinionData.isAgree,":").concat(o.processOpinion)),o.processInstanceId=this.processInstanceId,o.taskId=this.flowHandle.taskId,o.assignee=this.curNode.assignee,o.nextAssignee=this.opinionData.nextAssignee,o.variables=this.$refs.iframeWindowApp.onVariablesSubmit(),o.formData=e,this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0}),this.postAxios(this.urls.task.nextDealTask,o).then((function(e){t.$toast.clear();var o=e;t.submissionLoading=!1,0===o.errorCode?(t.$toast.success(o.message),setTimeout((function(){t.$router.push({path:"/formByJson"})}),1e3)):t.$toast.fail(o.message)})).catch((function(e){t.$toast.clear(),console.error(e),t.submissionLoading=!1}))},receipt:function(){var e=this,t={};t.processKey=this.flowHandle.processKey,t.processInstanceId=this.flowHandle.processInstanceId,t.taskId=this.flowHandle.taskId,this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0}),this.postAxios(this.urls.task.receipt,t).then((function(t){e.$toast.clear();var o=t;0===o.errorCode?e.processInst():e.$message.error(o.message)})).catch((function(t){e.$toast.clear(),console.error(t)})).finally((function(){}))},receiptDealTask:function(e){var t=this;this.submissionLoading=!0;var o={},s=this.nextNode.find((function(e){return e.nodeType===t.nextNodeType}));o.nodeType=this.flowHandle.currentNodeInfo.nodeType,o.nextNodeType=this.nextNodeType,o.processKey=this.flowHandle.processKey,o.processOpinion=this.processOpinion,o.processInstanceId=this.flowHandle.processInstanceId,o.taskId=this.flowHandle.taskId,o.assignee=this.flowHandle.currentNodeInfo.assignee,o.candidateUsers=s.candidateUsers,o.candidateGroups=s.candidateGroups,o.variables=this.$refs.iframeWindowApp.onVariablesSubmit(),o.formData=e,this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0}),this.postAxios(this.urls.task.receiptDealTask,o).then((function(e){t.$toast.clear();var o=e;0===o.errorCode?(t.$toast.success(o.message),setTimeout((function(){t.$router.push({path:"/formByJson"})}),1e3)):t.$toast.fail(o.message)})).catch((function(e){t.$toast.clear(),console.error(e)})).finally((function(){t.submissionLoading=!1}))},multipleDealTask:function(e){var t=this;this.submissionLoading=!0;var o={};o.nodeType=this.curNode.nodeType,o.nextNodeType=this.nextNodeType,o.processKey=this.flowHandle.processKey,o.processOpinion=this.processOpinion,o.processInstanceId=this.flowHandle.processInstanceId,o.taskId=this.flowHandle.taskId,o.assignee=this.flowHandle.currentNodeInfo.assignee,o.nextListAssignee=this.opinionData.nextAssignee.split(","),o.variables=this.$refs.iframeWindowApp.onVariablesSubmit(),o.formData=e,this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0}),this.postAxios(this.urls.task.multipleDealTask,o).then((function(e){t.$toast.clear();var o=e;0===o.errorCode?(t.$toast.success(o.message),setTimeout((function(){t.$router.push({path:"/formByJson"})}),1e3)):t.$toast.fail(o.message)})).catch((function(e){t.$toast.clear(),console.error(e)})).finally((function(){t.submissionLoading=!1}))},callActivity:function(e){var t=this;this.submissionLoading=!0;var o={};o.processKey=this.flowHandle.processKey,o.processInstanceId=this.flowHandle.processInstanceId,o.taskId=this.flowHandle.taskId,o.assignee=this.flowHandle.currentNodeInfo.assignee,o.nodeType=this.curNode.nodeType,o.formId=this.flowHandle.formId,o.processOpinion=this.processOpinion,o.nextNodeType=this.nextNodeType;var s=this.$refs.iframeWindowApp.toWindow("getSubFormData");o.variables=this.$refs.iframeWindowApp.onVariablesSubmit(),o.variables.subFormData=s.subFormData,o.formData=e,o.nextListAssignee=s.nextListAssignee,this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0}),this.postAxios(this.urls.task.callActivity,o).then((function(e){t.$toast.clear();var o=e;0===o.errorCode?(t.$toast.success(o.message),setTimeout((function(){t.$router.push({path:"/formByJson"})}),1e3)):t.$toast.fail(o.message)})).catch((function(e){t.$toast.clear(),console.error(e)})).finally((function(){t.submissionLoading=!1}))},backNodeLists:function(){var e=this,t={};t.processInstanceId=this.processInstanceId,t.taskId=this.flowHandle.taskId,this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0}),this.postAxios(this.urls.query.backNodeLists,t).then((function(t){e.$toast.clear();var o=t;0===o.errorCode?o.responseBody&&o.responseBody.length>0?(e.rejectNodeList=o.responseBody.map((function(e){return e.id=e.NodeExecutionId,e.text=e.nodeName,e})),e.opinionData.targetTaskDefKey=e.rejectNodeList[0]&&e.rejectNodeList[0].nodeTaskDefinitionKey,e.targetTaskDefKey=e.rejectNodeList&&e.rejectNodeList.length>0?e.rejectNodeList[0].nodeName:"",e.showPopup=!0):(e.$toast.fail("当前表单没有退回节点"),e.showPopup=!1):e.$toast.fail(o.message)})).catch((function(t){e.$toast.clear(),console.error(t)})).finally((function(){}))},rejectTask:function(){var e=this;this.submissionLoading=!0;var t={};t.processOpinion=this.processOpinion,t.processInstanceId=this.processInstanceId,t.targetTaskDefKey=this.opinionData.targetTaskDefKey,t.taskId=this.flowHandle.taskId,t.processKey=this.flowHandle.processKey,this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0}),this.postAxios(this.urls.task.rejectTask,t).then((function(t){e.$toast.clear();var o=t;0===o.errorCode?(e.$toast.success(o.message),setTimeout((function(){e.$router.push({path:"/formByJson"})}),1e3)):e.$toast.fail(o.message)})).catch((function(t){e.$toast.clear(),console.error(t)})).finally((function(){e.submissionLoading=!1}))},taskForward:function(){var e=this;this.submissionLoading=!0;var t={};t.processKey=this.flowHandle.processKey,t.nextAssignee=this.opinionData.nextAssignee,t.processInstanceId=this.processInstanceId,t.taskId=this.flowHandle.taskId,t.processOpinion=this.processOpinion,this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0}),this.postAxios(this.urls.task.taskForward,t).then((function(t){e.$toast.clear();var o=t;0===o.errorCode?(e.$toast.success(o.message),setTimeout((function(){e.$router.push({path:"/formByJson"})}),1e3)):e.$toast.fail(o.message)})).catch((function(t){e.$toast.clear(),console.error(t)})).finally((function(){e.submissionLoading=!1}))},setTheProcess:function(e){if("{}"!==JSON.stringify(e)){this.backToNode=!(!e.currentNodeInfo.button||!e.currentNodeInfo.button.hasOwnProperty("backToNode"))&&e.currentNodeInfo.button.backToNode,this.transfer=!(!e.currentNodeInfo.button||!e.currentNodeInfo.button.hasOwnProperty("transfer"))&&e.currentNodeInfo.button.transfer,e.formKey=e.formId,e.nodeId=e.currentNodeInfo.nodeId,this.theFormKey=e.formId;var t=e;t.token=this.userInfo.token,t.userUuid=this.userInfo.uuid,t.userName=this.userInfo.name,t.roleUuid=this.userInfo.roles.length>0?this.userInfo.roles.map((function(e){return e.id})):[],t.roleNmae=this.userInfo.roles.length>0?this.userInfo.roles.map((function(e){return e.name})):[],t.departUuid=this.userInfo.departments.length>0?this.userInfo.departments.map((function(e){return e.id})):[],t.departName=this.userInfo.departments.length>0?this.userInfo.departments.map((function(e){return e.name})):[],t.userPhone=this.userInfo.phone,t.userEmail=this.userInfo.email,t.curNodeName=e.currentNodeInfo.nodeName,t.nodeId=e.currentNodeInfo.nodeId,t.formKey=e.formId,t.processInstanceId=e.processInstanceId,e.nextNodeInfo&&Array.isArray(e.nextNodeInfo)&&e.nextNodeInfo.length>0?(t.nextNodeName=e.nextNodeInfo[0].nodeName,this.nextNode=e.nextNodeInfo.map((function(e){return e.id=e.nodeId,e.text=e.nodeName,e})),this.nextNodeId=this.nextNode[0]&&this.nextNode[0].nodeId):this.nextNode=null,this.processInfo=JSON.parse(JSON.stringify(t)),this.processInstanceId=e.processInstanceId,this.curNode=e.currentNodeInfo,this.curNodeType=this.curNode.nodeType,this.curNodeName=this.curNode.nodeName,this.basicFlowInstanceLogList=e.basicFlowInstanceLogList,this.flowHandle=e,this.curHandleName=[],this.curHandleName=this.curHandleName.concat(this.flowHandle.currentNodeInfo.candidateUsers).filter((function(e){return e}));var o=[];o.push(this.flowHandle.currentNodeInfo.assignee),o=o.concat(this.flowHandle.currentNodeInfo.candidateGroups),o=o.filter((function(e){return e})),this.getUserInfoByGroup(o,"curHandleName")}},processInst:function(){var e=this;this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0});var t={},o="";"add"==this.$route.query.formDaoType?(t={processKey:this.$route.query.processKey},o=this.urls.processInstStart):(t={processInstanceId:this.$route.query.processInstanceId},o=this.urls.query.getFlowBypId),this.loadTheInfo=!1,this.isReadOnly=this.$route.query.view,this.postAxios(o,t).then((function(t){if(e.$toast.clear(),0===t.errorCode){var o=t.responseBody||[];e.flowHandle=o,e.fileData={indexId:"",processInstanceId:o.processInstanceId},e.setTheProcess(o),"add"!==e.$route.query.formDaoType&&(e.initFormWitheValue(o.formData),e.$refs.iframeWindowApp.setBaseInfo(o))}else e.$toast.fail(t.message);e.loadTheInfo=!0})).catch((function(){e.loadTheInfo=!0,e.$toast.clear()}))},initFormWitheValue:function(e){this.$refs.iframeWindowApp.initFormWitheValue(e)},getUserInfoByGroup:function(e,t){var o=this,s={};s.group=e,this.postAxios(this.urls.query.getUserInfoByGroup,s).then((function(e){0===e.errorCode?"curHandleName"===t?o.curHandleName=e.responseBody.filter((function(e){return e})).map((function(e){return e.label})):(o.nextUsers=o.nextUsers.concat(e.responseBody),o.nextUsers=o.nextUsers.filter((function(e){return e})),1===o.nextUsers.length&&(o.opinionData.nextAssignee=o.nextUsers[0].value)):o.$toast.fail(e.message)})).catch((function(e){console.error(e)})).finally((function(){}))},showUserInputMet:function(e){var t=e.candidateUsers,o=e.candidateGroups;this.showUserInput="",this.nextUsers=[],"forward"===this.formDao?(t&&t.length>0&&(this.showUserInput="usersSelect",this.nextUsers=t),o&&o.length>0?(this.showUserInput="usersSelect",this.getUserInfoByGroup(o)):this.showUserInput="usersModal"):"普通"===this.nextNodeType&&(t.length>0||o.length>0)?(this.showUserInput="usersSelect",t&&t.length>0&&(this.nextUsers=t),o.length>0&&this.getUserInfoByGroup(o)):"会签"!==this.nextNodeType&&"级联审批"!==this.nextNodeType||(this.showUserInput="usersModal"),1===this.nextUsers.length&&(this.opinionData.nextAssignee=this.nextUsers[0].value)},hangUpTaskExamine:function(e){var t=this;this.submissionLoading=!0;var o={};o.assignee=this.flowHandle.currentNodeInfo.assignee,o.formData=e,o.nextNodeType=this.nextNodeType,o.nodeType=this.curNodeType,o.processInstanceId=this.flowHandle.processInstanceId,o.processKey=this.flowHandle.processKey,o.processOpinion=this.processOpinion,o.taskId=this.flowHandle.taskId,o.variables=this.$refs.iframeWindowApp.onVariablesSubmit(),this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0}),this.postAxios(this.urls.task.hangUpTaskExamine,o).then((function(e){t.$toast.clear();var o=e;0===o.errorCode?(t.$toast.success(o.message),setTimeout((function(){t.$router.push({path:"/formByJson"})}),1e3)):t.$toast.fail(o.message)})).catch((function(e){t.$toast.clear(),console.error(e)})).finally((function(){t.submissionLoading=!1}))},hangUpTaskBack:function(e){var t=this;this.submissionLoading=!0;var o={};o.formData=e,o.processInstanceId=this.flowHandle.processInstanceId,o.processKey=this.flowHandle.processKey,o.processOpinion=this.processOpinion,o.variables=this.$refs.iframeWindowApp.onVariablesSubmit(),this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0}),this.postAxios(this.urls.task.hangUpTaskBack,o).then((function(e){t.$toast.clear();var o=e;0===o.errorCode?(t.$toast.success(o.message),setTimeout((function(){t.$router.push({path:"/formByJson"})}),1e3)):t.$toast.fail(o.message)})).catch((function(e){t.$toast.clear(),console.error(e)})).finally((function(){t.submissionLoading=!1}))},hangUpTaskRelieve:function(e){var t=this;this.submissionLoading=!0;var o={};o.formData=e,o.processInstanceId=this.flowHandle.processInstanceId,o.processKey=this.flowHandle.processKey,o.processOpinion=this.processOpinion,o.variables=this.$refs.iframeWindowApp.onVariablesSubmit(),this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0}),this.postAxios(this.urls.task.hangUpTaskRelieve,o).then((function(e){t.$toast.clear();var o=e;0===o.errorCode?(t.$toast.success(o.message),setTimeout((function(){t.$router.push({path:"/formByJson"})}),1e3)):t.$toast.fail(o.message)})).catch((function(e){t.$toast.clear(),console.error(e)})).finally((function(){t.submissionLoading=!1}))},countersignDealTask:function(){var e=this;this.submissionLoading=!0;var t={};t.processInstanceId=this.flowHandle.processInstanceId,t.processKey=this.flowHandle.processKey,t.processOpinion=this.processOpinion,t.signAssignees=[],t.signAssignees.push(this.userMsg.uuid),this.$toast.loading({message:"提交中...",forbidClick:!0,duration:0}),this.postAxios(this.urls.task.countersignDealTask,t).then((function(t){e.$toast.clear();var o=t;0===o.errorCode?(e.$toast.success(o.message),setTimeout((function(){e.$router.push({path:"/formByJson"})}),1e3)):e.$toast.fail(o.message)})).catch((function(t){e.$toast.clear(),console.error(t)})).finally((function(){e.submissionLoading=!1}))},submission:function(){var e=this.formData;if("agree"===this.formDao)"usersSelect"===this.showUserInput&&""===this.opinionData.nextAssignee&&"会签"!==this.curNodeType&&"级联审批"!==this.curNodeType?g["a"].fail("请选择下一步处理人"):this.agree(e.formData);else if("reject"===this.formDao)""!==this.processOpinion?this.rejectTask():g["a"].fail("流程意见不能为空");else if("forward"===this.formDao)this.taskForward();else if("hangUpTaskExamine"===this.formDao){if(""===this.processOpinion)return g["a"].fail("流程意见不能为空"),!1;this.hangUpTaskExamine(e)}else if("hangUpTaskBack"===this.formDao){if(""===this.processOpinion)return g["a"].fail("流程意见不能为空"),!1;this.hangUpTaskBack(e)}else if("hangUpTaskRelieve"===this.formDao){if(""===this.processOpinion)return g["a"].fail("流程意见不能为空"),!1;this.hangUpTaskRelieve(e)}else if("countersignDealTask"===this.formDao){if(""===this.processOpinion)return g["a"].fail("流程意见不能为空"),!1;this.countersignDealTask()}}}},k=b,I=(o("d879"),Object(_["a"])(k,s,n,!1,null,"26309b4d",null));t["default"]=I.exports},c15d:function(e,t,o){},caad:function(e,t,o){"use strict";var s=o("23e7"),n=o("4d64").includes,i=o("44d2"),a=o("ae40"),r=a("indexOf",{ACCESSORS:!0,1:0});s({target:"Array",proto:!0,forced:!r},{includes:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),i("includes")},d879:function(e,t,o){"use strict";var s=o("c15d"),n=o.n(s);n.a},e1c0:function(e,t,o){}}]);