(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-40b79928"],{"06c5":function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));s("a630"),s("fb6a"),s("b0c0"),s("d3b7"),s("25f0"),s("3ca3");var a=s("6b75");function r(e,t){if(e){if("string"===typeof e)return Object(a["a"])(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(s):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?Object(a["a"])(e,t):void 0}}},"25f0":function(e,t,s){"use strict";var a=s("6eeb"),r=s("825a"),i=s("d039"),n=s("ad6d"),o="toString",l=RegExp.prototype,c=l[o],u=i((function(){return"/a/b"!=c.call({source:"a",flags:"b"})})),d=c.name!=o;(u||d)&&a(RegExp.prototype,o,(function(){var e=r(this),t=String(e.source),s=e.flags,a=String(void 0===s&&e instanceof RegExp&&!("flags"in l)?n.call(e):s);return"/"+t+"/"+a}),{unsafe:!0})},"4df4":function(e,t,s){"use strict";var a=s("0366"),r=s("7b0b"),i=s("9bdd"),n=s("e95a"),o=s("50c4"),l=s("8418"),c=s("35a1");e.exports=function(e){var t,s,u,d,h,m,f=r(e),p="function"==typeof this?this:Array,b=arguments.length,v=b>1?arguments[1]:void 0,w=void 0!==v,g=c(f),y=0;if(w&&(v=a(v,b>2?arguments[2]:void 0,2)),void 0==g||p==Array&&n(g))for(t=o(f.length),s=new p(t);t>y;y++)m=w?v(f[y],y):f[y],l(s,y,m);else for(d=g.call(f),h=d.next,s=new p;!(u=h.call(d)).done;y++)m=w?i(d,v,[u.value,y],!0):u.value,l(s,y,m);return s.length=y,s}},"6b75":function(e,t,s){"use strict";function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}s.d(t,"a",(function(){return a}))},a630:function(e,t,s){var a=s("23e7"),r=s("4df4"),i=s("1c7e"),n=!i((function(e){Array.from(e)}));a({target:"Array",stat:!0,forced:n},{from:r})},a9a7:function(e,t,s){"use strict";var a=s("ee62"),r=s.n(a);r.a},b85c:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));s("a4d3"),s("e01a"),s("d28b"),s("e260"),s("d3b7"),s("3ca3"),s("ddb0");var a=s("06c5");function r(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=Object(a["a"])(e))){var t=0,s=function(){};return{s:s,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,n=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return n=e.done,e},e:function(e){o=!0,i=e},f:function(){try{n||null==r["return"]||r["return"]()}finally{if(o)throw i}}}}},dd2d:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"eventReport"},[s("van-form",{attrs:{"scroll-to-error":"","validate-first":""},on:{submit:e.onSubmit,failed:e.failed}},[s("van-field",{attrs:{disabled:e.allDisable,readonly:"",required:"",rules:[{required:!0,message:"请选择"}],clickable:"",name:"reporter",value:e.reporter,label:"报告人",placeholder:"点击选择"},on:{click:function(t){e.showUserSelect=!e.allDisable}}}),s("van-popup",{attrs:{position:"bottom"},model:{value:e.showUserSelect,callback:function(t){e.showUserSelect=t},expression:"showUserSelect"}},[s("van-picker",{attrs:{"show-toolbar":"",columns:e.userList},on:{confirm:e.onConfirm,cancel:function(t){e.showUserSelect=!1}}})],1),s("van-field",{attrs:{name:"reportdepartment",disabled:e.allDisable,label:"报告部门",readonly:"",value:e.reportdepartment},on:{click:function(t){e.showReportdepartment=!e.allDisable&&0!=e.departmentsList.length}}}),s("van-popup",{attrs:{position:"bottom"},model:{value:e.showReportdepartment,callback:function(t){e.showReportdepartment=t},expression:"showReportdepartment"}},[s("van-picker",{attrs:{"show-toolbar":"",columns:e.departmentsList},on:{confirm:e.Reportdepartmentfirm,cancel:function(t){e.showReportdepartment=!1}}})],1),s("van-field",{attrs:{name:"reporttelephone",disabled:e.allDisable,label:"联系方式",readonly:"",value:e.$store.state.userLogin.userMsg.phone}}),s("van-field",{attrs:{name:"creationtime",label:"报告时间",disabled:e.allDisable,readonly:"",value:e.nowTime}}),s("van-field",{attrs:{readonly:"",required:"",rules:[{required:!0,message:"请选择"}],clickable:"",disabled:e.allDisable,name:"eventsource",value:e.eventsource,label:"事件来源",placeholder:"点击选择"},on:{click:function(t){e.showSourSelect=!e.allDisable}}}),s("van-popup",{attrs:{position:"bottom"},model:{value:e.showSourSelect,callback:function(t){e.showSourSelect=t},expression:"showSourSelect"}},[s("van-picker",{attrs:{"show-toolbar":"",columns:e.columns},on:{confirm:e.onSourConfirm,cancel:function(t){e.showSourSelect=!1}}})],1),s("van-field",{attrs:{readonly:"",required:"",rules:[{required:!0,message:"请选择"}],clickable:"",disabled:e.allDisable,name:"eventtime",value:e.eventtime,label:"发生时间",placeholder:"点击选择"},on:{click:function(){e.allDisable||e.selectTime("eventtime")}}}),s("van-field",{attrs:{name:"title",label:"事件标题",disabled:e.allDisable,required:"",rules:[{required:!0,message:"请填写"}]},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),s("van-field",{attrs:{disabled:e.allDisable,name:"eventdescribe",type:"textarea",rows:"5",autosize:"",label:"事件描述",required:"",rules:[{required:!0,message:"请填写"}]},model:{value:e.eventdescribe,callback:function(t){e.eventdescribe=t},expression:"eventdescribe"}}),s("van-field",{attrs:{required:"",rules:[{required:!0,message:"请选择"}],readonly:"",clickable:"",disabled:e.allDisable,name:"reasonclassify",value:e.reasonclassify,label:"事件原因分类",placeholder:"点击选择"},on:{click:function(t){e.showReasonclassify=!e.allDisable}}}),s("van-popup",{attrs:{position:"bottom"},model:{value:e.showReasonclassify,callback:function(t){e.showReasonclassify=t},expression:"showReasonclassify"}},[s("van-picker",{attrs:{"show-toolbar":"",columns:e.typeColumns},on:{confirm:e.onReasonclassifyConfirm,cancel:function(t){e.showReasonclassify=!1}}})],1),s("van-field",{attrs:{readonly:"",required:"",rules:[{required:!0,message:"请选择"}],clickable:"",name:"waiter",value:e.waiter,label:"一线人员",disabled:e.allDisable,placeholder:"点击选择"},on:{click:function(t){e.showWaiterSelect=!e.allDisable}}}),s("van-popup",{attrs:{position:"bottom"},model:{value:e.showWaiterSelect,callback:function(t){e.showWaiterSelect=t},expression:"showWaiterSelect"}},[s("van-picker",{attrs:{"show-toolbar":"",columns:e.userList},on:{confirm:e.onWaiterConfirm,cancel:function(t){e.showWaiterSelect=!1}}})],1),s("van-field",{attrs:{required:"",rules:[{required:!0,message:"请选择"}],readonly:"",clickable:"",name:"level",value:e.level,label:"事件影响度",disabled:e.allDisable,placeholder:"点击选择"},on:{click:function(t){e.showLevel=!e.allDisable}}}),s("van-popup",{attrs:{position:"bottom"},model:{value:e.showLevel,callback:function(t){e.showLevel=t},expression:"showLevel"}},[s("van-picker",{attrs:{"show-toolbar":"",columns:e.levelColumns},on:{confirm:e.onLevelConfirm,cancel:function(t){e.showLevel=!1}}})],1),s("van-field",{attrs:{required:"",rules:[{required:!0,message:"请选择"}],readonly:"",clickable:"",name:"urgency",value:e.urgency,label:"事件紧急度",disabled:e.allDisable,placeholder:"点击选择"},on:{click:function(t){e.showUrgency=!e.allDisable}}}),s("van-popup",{attrs:{position:"bottom"},model:{value:e.showUrgency,callback:function(t){e.showUrgency=t},expression:"showUrgency"}},[s("van-picker",{attrs:{"show-toolbar":"",columns:e.urgencyColumns},on:{confirm:e.onUrgencyConfirm,cancel:function(t){e.showUrgency=!1}}})],1),s("van-field",{attrs:{readonly:"",clickable:"",name:"priority",value:e.priority,disabled:e.allDisable,label:"事件等级",placeholder:"点击选择"}}),s("van-field",{attrs:{name:"describeattach",label:"附件"},scopedSlots:e._u([{key:"input",fn:function(){return[e.allDisable?e._e():s("van-uploader",{attrs:{name:"file","after-read":e.afterRead,"before-delete":e.beforeDelete},model:{value:e.describeattach,callback:function(t){e.describeattach=t},expression:"describeattach"}}),e.allDisable?s("section",{on:{click:function(t){e.showPreview=!0}}},[s("lazy-component",e._l(e.$route.params.showItem.formData.describeattach,(function(t){return s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.urls.download+"?uuid="+t.uuid+"&token="+e.accessToken,expression:"urls.download+'?uuid='+img.uuid+'&token='+accessToken"}],key:t.uuid,staticClass:"describeattachImg"})})),0)],1):e._e()]},proxy:!0}])}),s("van-popup",{attrs:{position:"bottom"},model:{value:e.showTimePick,callback:function(t){e.showTimePick=t},expression:"showTimePick"}},[s("van-datetime-picker",{attrs:{type:"datetime","min-date":e.minDate,"max-date":e.maxDate},on:{confirm:e.onStarttimeConfirm,cancel:function(t){e.showTimePick=!1,e.timeBase=""}}})],1),s("van-image-preview",{attrs:{images:e.imagesList},on:{change:e.onChangePreview},scopedSlots:e._u([{key:"index",fn:function(){return[e._v("第"+e._s(e.index)+"页")]},proxy:!0}]),model:{value:e.showPreview,callback:function(t){e.showPreview=t},expression:"showPreview"}}),s("div",{staticClass:"formDao"},[e.allDisable?e._e():s("van-button",{staticClass:"btn",attrs:{round:"",block:"",type:"info","native-type":"submit",loading:e.loading,"loading-text":"提交中...",disabled:e.submitDisabled}},[e._v(" 提交 ")]),e.allDisable?s("van-button",{staticClass:"btn",attrs:{round:"",block:"","native-type":"button",type:"info"},on:{click:function(t){return e.$router.go(-1)}}},[e._v(" 返回 ")]):e._e()],1)],1)],1)},r=[],i=(s("4de4"),s("4160"),s("b0c0"),s("d3b7"),s("159b"),s("b85c")),n={name:"eventReport",data:function(){return{processKey:"kfw200318105905138",reporter:this.$store.state.userLogin.userMsg.name,nowTime:"",reportdepartment:this.$store.state.userLogin.userMsg.departments.length>0?this.$store.state.userLogin.userMsg.departments[0].name:"",eventsource:"人工",eventtime:"",title:"",eventdescribe:"",interruptstarttime:"",interruptendtime:"",reasonclassify:"软件错误",waiter:"",level:"",urgency:"",priority:"",describeattach:[],describeattachList:[],timeBase:"",columns:[{text:"OA"},{text:"监控"},{text:"人工"}],typeColumns:[{text:"软件错误"},{text:"设备老化"},{text:"网络闪断"},{text:"意外变更"},{text:"其他"}],levelColumns:[{text:"一级:服务中断"},{text:"二级:部分中断或质量下降"},{text:"三级:未中断但存在隐患"}],urgencyColumns:[{text:"一级"},{text:"二级"},{text:"三级"}],showUserSelect:!1,showSourSelect:!1,showTimePick:!1,showReasonclassify:!1,showLevel:!1,showUrgency:!1,showReportdepartment:!1,showWaiterSelect:!1,minDate:new Date((new Date).getFullYear(),0,1),maxDate:new Date((new Date).getFullYear()+5,12,30),userList:[],departmentsList:[],baseInfo:{},formData:{},loading:!1,submitDisabled:!1,allDisable:!1,accessToken:window.localStorage.getItem("accessToken"),showPreview:!1,index:1,imagesList:[]}},beforeMount:function(){var e=this;if(this.getUserList(),this.$store.state.userLogin.userMsg.departments&&this.$store.state.userLogin.userMsg.departments.forEach((function(t){e.departmentsList.push({text:t.name})})),this.nowTime=this.getNowFormatTime(),this.eventtime=this.getNowFormatTime(),this.$route.params.showItem){for(var t in this.allDisable=!0,this.$route.params.showItem.formData){var s=this.$route.params.showItem.formData[t];this.$set(this.$data,t,s)}this.$route.params.showItem.formData&&this.$route.params.showItem.formData.describeattach&&this.$route.params.showItem.formData.describeattach.forEach((function(t){e.imagesList.push(e.urls.download+"?uuid="+t.uuid+"&token="+e.accessToken)}))}},methods:{onChangePreview:function(e){this.index=e+1},initForm:function(){this.reporter=this.$store.state.userLogin.userMsg.name,this.nowTime="",this.reportdepartment=this.$store.state.userLogin.userMsg.departments.length>0?this.$store.state.userLogin.userMsg.departments[0].name:"",this.eventsource="人工",this.eventtime="",this.title="",this.eventdescribe="",this.interruptstarttime="",this.interruptendtime="",this.reasonclassify="软件错误",this.waiter="",this.level="",this.urgency="",this.priority="",this.describeattach=[],this.describeattachList=[],this.timeBase=""},selectTime:function(e){this.timeBase=e,this.showTimePick=!0},onConfirm:function(e){var t,s=Object(i["a"])(this.userList);try{for(s.s();!(t=s.n()).done;){var a=t.value;if(a.name==e.text){Object.prototype.hasOwnProperty.call(a.department,"name")?this.reportdepartment=a.department.name:this.reportdepartment="";break}}}catch(r){s.e(r)}finally{s.f()}this.reporter=e.text,this.showUserSelect=!1},onWaiterConfirm:function(e){this.waiter=e.text,this.showWaiterSelect=!1},Reportdepartmentfirm:function(e){this.reportdepartment=e.text,this.showReportdepartment=!1},onLevelConfirm:function(e){this.level=e.text,this.showLevel=!1,""!=this.urgency&&this.setPriority()},onUrgencyConfirm:function(e){this.urgency=e.text,this.showUrgency=!1,""!=this.level&&this.setPriority()},setPriority:function(){var e="一"==this.level.substring(0,1)?1:"二"==this.level.substring(0,1)?2:3,t="一"==this.urgency.substring(0,1)?1:"二"==this.urgency.substring(0,1)?2:3;1==e&&(this.priority=3==t?"二级":"一级"),2==e&&(this.priority=1==t?"一级":2==t?"二级":"三级"),3==e&&(this.priority=1==t?"二级":2==t?"三级":"四级")},onReasonclassifyConfirm:function(e){this.reasonclassify=e.text,this.showReasonclassify=!1},onStarttimeConfirm:function(e){""!==this.timeBase&&this.$set(this.$data,this.timeBase,this.getNowFormatTime(e)),this.showTimePick=!1},onSourConfirm:function(e){this.eventsource=e.text,this.showSourSelect=!1},getUserList:function(){var e=this;e.userList=[],this.postAxios(this.urls.user.all,{}).then((function(t){if(0===t.errorCode){var s=t.responseBody||[];s.filter((function(e){return 0===e.state})).forEach((function(t){var s=t;s.text=t.name,e.$route.params.showItem&&e.$route.params.showItem.formData.waiter&&e.$route.params.showItem.formData.waiter==s.uuid&&e.$set(e.$data,"waiter",s.text),e.userList.push(s)}))}}))},afterRead:function(e){var t=this;e.status="uploading",e.message="上传中...";var s=new FormData;s.append("indexId",""),s.append("processInstanceId",""),s.append("file",e.file);var a={headers:{"Content-Type":"multipart/form-data"}},r=this;this.submitDisabled=!0,this.$axios.post(this.urls.restUpload,s,a).then((function(s){t.submitDisabled=!1,0==s.errorCode?(e.status="done",e.message="上传成功",e.uuid=s.responseBody.uuid,t.describeattachList.push(s.responseBody)):(e.status="failed",e.message="上传失败"),setTimeout((function(){r.describeattach=r.describeattach.filter((function(e){return"done"==e.status}))}),1e3)})).catch((function(){e.status="failed",e.message="上传失败",setTimeout((function(){r.describeattach=r.describeattach.filter((function(e){return"done"==e.status}))}),1e3)}))},beforeDelete:function(e){var t=this;this.postAxios(this.urls.restDelete,{uuid:e.uuid}).then((function(s){0===s.errorCode&&(t.describeattach=t.describeattach.filter((function(t){return t.uuid!=e.uuid})),t.describeattachList=t.describeattach.filter((function(t){return t.uuid!=e.uuid})))}))},processInstStart:function(){var e=this;return new Promise((function(t){e.postAxios(e.urls.processInstStart,{processKey:e.processKey}).then((function(s){if(0===s.errorCode){var a=s.responseBody||[];t(a)}else e.loading=!1}))}))},processInstNextDealTask:function(e){var t=this,s=this.formData.waiter;this.userList.forEach((function(e){s==e.text&&(t.formData.waiter=e.uuid)}));var a={eventnumber:"[事件工单编号]",assignee:e.currentNodeInfo.assignee,taskId:e.taskId,nextNodeType:"普通",nextAssignee:"",processKey:this.processKey,nodeType:"普通",variables:{ismehandle:"否",waiter:this.formData.waiter},processOpinion:"手机提交",processInstanceId:e.processInstanceId,formData:this.formData};this.postAxios(this.urls.processInstNextDealTask,a).then((function(e){t.$toast.clear(),0===e.errorCode&&t.$dialog.confirm({title:"提交成功",message:"",confirmButtonText:"继续报告"}).then((function(){t.loading=!1,t.initForm()})).catch((function(){t.loading=!1,t.$router.push({path:"/"})}))}))},failed:function(){this.$toast("请填写必填项")},onSubmit:function(e){var t=this;this.formData=e,this.formData.ismehandle="否",this.formData.describeattach=this.describeattachList,this.loading=!0,this.$toast.loading({message:"提交...",forbidClick:!0,duration:0}),this.processInstStart().then((function(e){t.processInstNextDealTask(e)}))}}},o=n,l=(s("a9a7"),s("2877")),c=Object(l["a"])(o,a,r,!1,null,"1b598201",null);t["default"]=c.exports},ee62:function(e,t,s){},fb6a:function(e,t,s){"use strict";var a=s("23e7"),r=s("861d"),i=s("e8b5"),n=s("23cb"),o=s("50c4"),l=s("fc6a"),c=s("8418"),u=s("b622"),d=s("1dde"),h=s("ae40"),m=d("slice"),f=h("slice",{ACCESSORS:!0,0:0,1:2}),p=u("species"),b=[].slice,v=Math.max;a({target:"Array",proto:!0,forced:!m||!f},{slice:function(e,t){var s,a,u,d=l(this),h=o(d.length),m=n(e,h),f=n(void 0===t?h:t,h);if(i(d)&&(s=d.constructor,"function"!=typeof s||s!==Array&&!i(s.prototype)?r(s)&&(s=s[p],null===s&&(s=void 0)):s=void 0,s===Array||void 0===s))return b.call(d,m,f);for(a=new(void 0===s?Array:s)(v(f-m,0)),u=0;m<f;m++,u++)m in d&&c(a,u,d[m]);return a.length=u,a}})}}]);